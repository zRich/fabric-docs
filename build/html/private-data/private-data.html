

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Private data &mdash; hyperledger-fabricdocs master 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="用例" href="../usecases.html" />
    <link rel="prev" title="The Ordering Service" href="../orderer/ordering_service.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">v2.0 Alpha 新功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../key_concepts.html">Key Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../blockchain.html">介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functionalities.html">超级账本Fabric功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fabric_model.html">超级账本Fabric模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/network.html">Blockchain network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../identity/identity.html">Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../membership/membership.html">Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peers/peers.html">Peers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smartcontract/smartcontract.html">Smart Contracts and Chaincode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ledger/ledger.html">Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orderer/ordering_service.html">The Ordering Service</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Private data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-private-data">What is private data?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-private-data-collection">What is a private data collection?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#when-to-use-a-collection-within-a-channel-vs-a-separate-channel">When to use a collection within a channel vs. a separate channel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-use-case-to-explain-collections">A use case to explain collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-flow-with-private-data">Transaction flow with private data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#purging-private-data">Purging private data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-a-private-data-collection-is-defined">How a private data collection is defined</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usecases.html">用例</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">开发应用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../key_concepts.html">Key Concepts</a> &raquo;</li>
        
      <li>Private data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/private-data/private-data.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="private-data">
<h1>Private data<a class="headerlink" href="#private-data" title="永久链接至标题">¶</a></h1>
<div class="section" id="what-is-private-data">
<h2>What is private data?<a class="headerlink" href="#what-is-private-data" title="永久链接至标题">¶</a></h2>
<p>在某个通道上的一组组织需要对该通道上的其他组织保持数据私密的情况下，它们可以选择创建一个新通道，其中只包含需要访问数据的组织。但是，在每一种情况下创建单独的通道会产生额外的管理开销(维护链码版本、策略、MSPs等)，并且不允许在保持部分数据私有的同时，让所有通道参与者都看到交易。</p>
<p>这就是为什么从v1.2开始，Fabric就提供了创建私有数据集合的能力，这使得通道上定义的组织子集能够背书、提交或查询私有数据，而不必创建单独的通道。</p>
</div>
<div class="section" id="what-is-a-private-data-collection">
<h2>What is a private data collection?<a class="headerlink" href="#what-is-a-private-data-collection" title="永久链接至标题">¶</a></h2>
<p>一个私有数据集合由两个元素组成：</p>
<ol class="simple">
<li><p><strong>The actual private data</strong>, sent peer-to-peer <a class="reference external" href="../gossip.html">via gossip protocol</a>
to only the organization(s) authorized to see it. This data is stored in a
private state database on the peers of authorized organizations (sometimes
called a “side” database, or “SideDB”), which can be accessed from chaincode
on these authorized peers.
The ordering service is not involved here and does not see the
private data. Note that because gossip distributes the private data peer-to-peer
across authorized organizations, it is required to set up anchor peers on the channel,
and configure CORE_PEER_GOSSIP_EXTERNALENDPOINT on each peer,
in order to bootstrap cross-organization communication.</p></li>
<li><p><strong>A hash of that data</strong>, which is endorsed, ordered, and written to the ledgers
of every peer on the channel. The hash serves as evidence of the transaction and
is used for state validation and can be used for audit purposes.</p></li>
</ol>
<p>下图说明了一个被授权拥有私有数据的节点和一个未授权的节点的账本内容。</p>
<p><img alt="../_images/PrivateDataConcept-2.png" src="../_images/PrivateDataConcept-2.png" />private-data.private-data</p>
<p>如果集合成员陷入争议，或者如果他们想将资产转让给第三方，则可以决定与其他方共享私有数据。然后，第三方可以计算私有数据的散列，并查看它是否与通道账本上的状态匹配，从而证明在某个时间点上集合成员之间的状态存在。</p>
<div class="section" id="when-to-use-a-collection-within-a-channel-vs-a-separate-channel">
<h3>When to use a collection within a channel vs. a separate channel<a class="headerlink" href="#when-to-use-a-collection-within-a-channel-vs-a-separate-channel" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>Use <strong>channels</strong> when entire transactions (and ledgers) must be kept
confidential within a set of organizations that are members of the channel.</p></li>
<li><p>Use <strong>collections</strong> when transactions (and ledgers) must be shared among a set
of organizations, but when only a subset of those organizations should have
access to some (or all) of the data within a transaction.  Additionally,
since private data is disseminated peer-to-peer rather than via blocks,
use private data collections when transaction data must be kept confidential
from ordering service nodes.</p></li>
</ul>
</div>
</div>
<div class="section" id="a-use-case-to-explain-collections">
<h2>A use case to explain collections<a class="headerlink" href="#a-use-case-to-explain-collections" title="永久链接至标题">¶</a></h2>
<p>考虑一个由5个组织组成的通道，他们交易农产品：</p>
<ul class="simple">
<li><p><strong>A Farmer</strong> selling his goods abroad</p></li>
<li><p><strong>A Distributor</strong> moving goods abroad</p></li>
<li><p><strong>A Shipper</strong> moving goods between parties</p></li>
<li><p><strong>A Wholesaler</strong> purchasing goods from distributors</p></li>
<li><p><strong>A Retailer</strong> purchasing goods from shippers and wholesalers</p></li>
</ul>
<p>分销商可能希望与农场主和托运商之间保持私密交易，以对批发商和零售商保密交易条款(以免暴露他们收取的加价)。</p>
<p>分销商还可能希望与批发商建立单独的私有数据关系，因为它向批发商收取的价格比零售商低。</p>
<p>批发商还可能希望与零售商和托运商建立私有数据关系。</p>
<p>与其为这些关系定义许多小通道，不如定义多个私有数据集合(PDC)在以下各方之间共享私有数据：</p>
<ol class="simple">
<li><p>PDC1: <strong>Distributor</strong>, <strong>Farmer</strong> and <strong>Shipper</strong></p></li>
<li><p>PDC2: <strong>Distributor</strong> and <strong>Wholesaler</strong></p></li>
<li><p>PDC3: <strong>Wholesaler</strong>, <strong>Retailer</strong> and <strong>Shipper</strong></p></li>
</ol>
<p><img alt="../_images/PrivateDataConcept-1.png" src="../_images/PrivateDataConcept-1.png" />private-data.private-data</p>
<p>使用此示例，分销商拥有的节点在其账本中拥有多个私有数据库，其中包括来自分销商、农民和发货人关系以及分销商和批发商关系的私有数据。因为这些数据库与保存通道账本的数据库是分开的，所以私有数据有时被称为“SideDB”。</p>
<p><img alt="../_images/PrivateDataConcept-3.png" src="../_images/PrivateDataConcept-3.png" />private-data.private-data</p>
</div>
<div class="section" id="transaction-flow-with-private-data">
<h2>Transaction flow with private data<a class="headerlink" href="#transaction-flow-with-private-data" title="永久链接至标题">¶</a></h2>
<p>当在链码中引用私有数据集合时，为了保护私有数据的机密性，在提案、背书的和提交交易到账本时，交易流程略有不同。</p>
<p>关于不使用私有数据的交易流程的详细信息，请参阅我们关于交易流程的文档。</p>
<ol class="simple">
<li><p>The client application submits a proposal request to invoke a chaincode
function (reading or writing private data) to endorsing peers which are
part of authorized organizations of the collection. The private data, or
data used to generate private data in chaincode, is sent in a <code class="docutils literal notranslate"><span class="pre">transient</span></code>
field of the proposal.</p></li>
<li><p>The endorsing peers simulate the transaction and store the private data in
a <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code> (a temporary storage local to the peer). They
distribute the private data, based on the collection policy, to authorized peers
via <a class="reference external" href="../gossip.html">gossip</a>.</p></li>
<li><p>The endorsing peer sends the proposal response back to the client. The proposal
response includes the endorsed read/write set, which includes public
data, as well as a hash of any private data keys and values. <em>No private data is
sent back to the client</em>. For more information on how endorsement works with
private data, click <a class="reference external" href="../private-data-arch.html#endorsement">here</a>.</p></li>
<li><p>The client application submits the transaction (which includes the proposal
response with the private data hashes) to the ordering service. The transactions
with the private data hashes get included in blocks as normal.
The block with the private data hashes is distributed to all the peers. In this way,
all peers on the channel can validate transactions with the hashes of the private
data in a consistent way, without knowing the actual private data.</p></li>
<li><p>At block commit time, authorized peers use the collection policy to
determine if they are authorized to have access to the private data. If they do,
they will first check their local <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code> to determine if they
have already received the private data at chaincode endorsement time. If not,
they will attempt to pull the private data from another authorized peer. Then they
will validate the private data against the hashes in the public block and commit the
transaction and the block. Upon validation/commit, the private data is moved to
their copy of the private state database and private writeset storage. The
private data is then deleted from the <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code>.</p></li>
</ol>
</div>
<div class="section" id="purging-private-data">
<h2>Purging private data<a class="headerlink" href="#purging-private-data" title="永久链接至标题">¶</a></h2>
<p>对于非常敏感的数据，即使共享私有数据的各方也可能希望 — 或政府法规要求 — 定期“清除”其peer的数据，留下区块链上的数据哈希作为私有数据的不可变证据。</p>
<p>在某些情况下，私有数据只需要存在于节点的私有数据库上，直到可以将其复制到区块链外部的数据库中为止。数据也可能只需要存在于节点上，直到使用它完成链码业务流程(交易结算、合约履行等)。</p>
<p>为了支持这些用例，如果已经持续N个块都没有修改私有数据了，N是可配置的，则可以清除它。清除的私有数据不能从链码查询，并且其他节点也请求不到。</p>
</div>
<div class="section" id="how-a-private-data-collection-is-defined">
<h2>How a private data collection is defined<a class="headerlink" href="#how-a-private-data-collection-is-defined" title="永久链接至标题">¶</a></h2>
<p>有关集合定义的更多详细信息，以及关于私有数据和集合的其他更细层级的信息，请参阅私有数据主题。</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../usecases.html" class="btn btn-neutral float-right" title="用例" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../orderer/ordering_service.html" class="btn btn-neutral" title="The Ordering Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>