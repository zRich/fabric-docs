

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Commercial paper tutorial &mdash; hyperledger-fabricdocs master 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="搭建你的第一个网络（BYFN）" href="../build_network.html" />
    <link rel="prev" title="Writing Your First Application" href="../write_first_app.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">v2.0 Alpha 新功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">开发应用程序</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Commercial paper tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-samples">Download samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-network">Create network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-as-magnetocorp">Working as MagnetoCorp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smart-contract">Smart contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-contract">Install contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiate-contract">Instantiate contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-structure">Application structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-dependencies">Application dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wallet">Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issue-application">Issue application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-as-digibank">Working as DigiBank</a></li>
<li class="toctree-l3"><a class="reference internal" href="#digibank-applications">Digibank applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-as-digibank">Run as DigiBank</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buy-application">Buy application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeem-application">Redeem application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../build_network.html">搭建你的第一个网络（BYFN）</a></li>
<li class="toctree-l2"><a class="reference internal" href="../channel_update_tutorial.html">向通道添加组织</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../private_data_tutorial.html">在Fabric里面使用私有数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode.html">链码教程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4ade.html">链码开发者</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../videos.html">视频</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Commercial paper tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/commercial_paper.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="commercial-paper-tutorial">
<h1>Commercial paper tutorial<a class="headerlink" href="#commercial-paper-tutorial" title="永久链接至标题">¶</a></h1>
<p>受众 ：架构师、应用程序和智能合约开发者、管理员。</p>
<p>本教程会知道你怎么样安装使用一个商业票据的应用和智能合约。它是一个面向任务的主题，所以它强调过程而不是概念。当您想更详细地理解这些概念时，您可以阅读“应用程序开发”主题。</p>
<p><img alt="../_images/commercial_paper.diagram.1.png" src="../_images/commercial_paper.diagram.1.png" />commercialpaper.tutorial <em>In this tutorial
two organizations, MagnetoCorp and DigiBank, trade commercial paper with each
other using PaperNet, a Hyperledger Fabric blockchain network.</em></p>
<p>一旦你建立了一个基本的网络，你将扮演伊莎贝拉（Isabella），她是磁石公司的一名员工，将代表磁石公司发行一份商业票据。然后，你将转换角色，扮演电子银行(DigiBank)的员工巴拉吉(Balaji)，他将购买这张商业票据，持有一段时间，然后跟MagnetoCorp兑换一小笔利润。</p>
<p>您将扮演不同组织中的开发人员、最终用户和管理员的角色，执行以下步骤，这些步骤旨在帮助您理解作为两个独立工作的不同组织协作是什么样子的，但是要根据超级账本网络中相互同意的规则进行协作。</p>
<ul class="simple">
<li><p><a class="reference external" href="#prerequisites">Set up machine</a> and <a class="reference external" href="#download-samples">download samples</a></p></li>
<li><p><a class="reference external" href="#create-network">Create a network</a></p></li>
<li><p>Understand the structure of a <a class="reference external" href="#smart-contract">smart contract</a></p></li>
<li><p>Work as an organization, <a class="reference external" href="#working-as-magnetocorp">MagnetoCorp</a>, to
<a class="reference external" href="#install-contract">install</a> and <a class="reference external" href="#instantiate-contract">instantiate</a> smart
contract</p></li>
<li><p>Understand the structure of a MagnetoCorp
<a class="reference external" href="#application-structure">application</a>, including its
<a class="reference external" href="#application-dependencies">dependencies</a></p></li>
<li><p>Configure and use a <a class="reference external" href="#wallet">wallet and identities</a></p></li>
<li><p>Run a MagnetoCorp application to <a class="reference external" href="#issue-application">issue a commercial
paper</a></p></li>
<li><p>Understand how a second organization, <a class="reference external" href="#working-as-digibank">Digibank</a>, uses
the smart contract in their <a class="reference external" href="#digibank-applications">applications</a></p></li>
<li><p>As Digibank, <a class="reference external" href="#run-as-digibank">run</a> applications that
<a class="reference external" href="#buy-application">buy</a> and <a class="reference external" href="#redeem-application">redeem</a> commercial paper</p></li>
</ul>
<p>本教程已经在MacOS和Ubuntu上进行了测试，应该可以在其他Linux发行版上使用。Windows版本正在开发中。</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="永久链接至标题">¶</a></h2>
<p>在开始之前，您必须安装本教程所需的一些必备技术软件。我们已经把这些降到最低，这样你就可以快速开始了。</p>
<p>你必须安装以下技术软件:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://nodejs.org/en/about/"><strong>Node</strong></a> version 8.9.0, or higher. Node is
a JavaScript runtime that you can use to run applications and smart
contracts. You are recommended to use the LTS (Long Term Support) version
of node. Install node <a class="reference external" href="https://nodejs.org/en/">here</a>.</p></li>
<li><p><a class="reference external" href="https://www.docker.com/get-started"><strong>Docker</strong></a> version 18.06, or higher.
Docker help developers and administrators create standard environments for
building and running applications and smart contracts. Hyperledger Fabric is
provided as a set of Docker images, and the PaperNet smart contract will run
in a docker container. Install Docker
<a class="reference external" href="https://www.docker.com/get-started">here</a>.</p></li>
</ul>
<p>你会发现安装以下技术软件很有帮助:</p>
<ul>
<li><p>A source code editor, such as
<a class="reference external" href="https://code.visualstudio.com/"><strong>Visual Studio Code</strong></a> version 1.28, or
higher. VS Code will help you develop and test your application and smart
contract. Install VS Code <a class="reference external" href="https://code.visualstudio.com/Download">here</a>.</p>
<p>Many excellent code editors are available including
<a class="reference external" href="https://atom.io/">Atom</a>, <a class="reference external" href="http://www.sublimetext.com/">Sublime Text</a> and
<a class="reference external" href="http://www.sublimetext.com/">Brackets</a>.</p>
</li>
</ul>
<p>随着您对应用程序和智能合约开发越来越有经验，您可能会发现安装以下技术很有帮助。当你第一次运行教程时，不需要安装这些:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/creationix/nvm"><strong>Node Version Manager</strong></a>. NVM helps you
easily switch between different versions of node – it can be really helpful
if you’re working on multiple projects at the same time. Install NVM
<a class="reference external" href="https://github.com/creationix/nvm#installation">here</a>.</p></li>
</ul>
</div>
<div class="section" id="download-samples">
<h2>Download samples<a class="headerlink" href="#download-samples" title="永久链接至标题">¶</a></h2>
<p>商业票据教程是一个名为fabric -samples的公共GitHub仓库中保存的超级账本示例之一。在您的机器上运行本教程时，您的第一个任务是下载fabric-samples仓库。</p>
<p><img alt="../_images/commercial_paper.diagram.2.png" src="../_images/commercial_paper.diagram.2.png" />commercialpaper.download <em>Download the
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> GitHub repository to your local machine.</em></p>
<p>$GOPATH是超级账本中的一个重要环境变量;它标识要安装的根目录。正确使用任何一种编程语言都是非常重要的!打开一个新的终端窗口，使用env命令检查$GOPATH是否已设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env
...
GOPATH=/Users/username/go
NVM_BIN=/Users/username/.nvm/versions/node/v8.11.2/bin
NVM_IOJS_ORG_MIRROR=https://iojs.org/dist
...
</pre></div>
</div>
<p>如果没有设置$GOPATH，请使用以下说明</p>
<p>You can now create a directory relative to <code class="docutils literal notranslate"><span class="pre">$GOPATH</span> </code>where <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> will
be installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p $GOPATH/src/github.com/hyperledger/
$ cd $GOPATH/src/github.com/hyperledger/
</pre></div>
</div>
<p>使用git克隆命令将fabric-samples库复制到这个位置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/hyperledger/fabric-samples.git
</pre></div>
</div>
<p>请随意检查fabric-samples的目录结构</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd fabric-samples
$ ls

CODE_OF_CONDUCT.md    balance-transfer            fabric-ca
CONTRIBUTING.md       basic-network               first-network
Jenkinsfile           chaincode                   high-throughput
LICENSE               chaincode-docker-devmode    scripts
MAINTAINERS.md        commercial-paper            README.md
fabcar
</pre></div>
</div>
<p>请注意商业票据目录——这就是我们的示例所在的位置!</p>
<p>您现在已经完成了教程的第一阶段!在继续操作时，将为不同的用户和组件打开多个命令窗口。例如:</p>
<ul class="simple">
<li><p>to run applications on behalf of Isabella and Balaji who will trade commercial
paper with each other</p></li>
<li><p>to issue commands to on behalf of administrators from MagnetoCorp and
DigiBank, including installing and instantiating smart contracts</p></li>
<li><p>to show peer, orderer and CA log output</p></li>
</ul>
<p>我们将清楚地说明什么时候应该从特定的命令窗口运行命令;例如</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls
</pre></div>
</div>
<p>指示您应该从Isabella的窗口运行ls命令。</p>
</div>
<div class="section" id="create-network">
<h2>Create network<a class="headerlink" href="#create-network" title="永久链接至标题">¶</a></h2>
<p>本教程目前使用的基本网络;它将很快更新到一个配置，更好地反映了PaperNet的多组织结构。目前，这个网络足以向您展示如何开发应用程序和智能合约。</p>
<p><img alt="../_images/commercial_paper.diagram.3.png" src="../_images/commercial_paper.diagram.3.png" />commercialpaper.network <em>The Hyperledger
Fabric basic network comprises a peer and its ledger database, an orderer and a
certificate authority (CA). Each of these components runs as a docker
container.</em></p>
<p>peer节点、它的分类账、orderer节点和CA都在各自的docker容器中运行。在生产环境中，组织通常使用与其他系统共享的现有ca;他们并不专注于Fabric网络。</p>
<p>您可以使用fabric-samplesbasic-network目录中包含的命令和配置来管理基本网络。让我们使用start.sh shell脚本启动本地机器上的网络：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd fabric-samples/basic-network
$ ./start.sh

docker-compose -f docker-compose.yml up -d ca.example.com orderer.example.com peer0.org1.example.com couchdb
Creating network &quot;net_basic&quot; with the default driver
Pulling ca.example.com (hyperledger/fabric-ca:)...
latest: Pulling from hyperledger/fabric-ca
3b37166ec614: Pull complete
504facff238f: Pull complete
(...)
Pulling orderer.example.com (hyperledger/fabric-orderer:)...
latest: Pulling from hyperledger/fabric-orderer
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Pulling couchdb (hyperledger/fabric-couchdb:)...
latest: Pulling from hyperledger/fabric-couchdb
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Pulling peer0.org1.example.com (hyperledger/fabric-peer:)...
latest: Pulling from hyperledger/fabric-peer
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Creating orderer.example.com ... done
Creating couchdb             ... done
Creating ca.example.com         ... done
Creating peer0.org1.example.com ... done
(...)
2018-11-07 13:47:31.634 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-11-07 13:47:31.730 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
</pre></div>
</div>
<p>注意docker-compose -f docker-compose.yml up -d ca.example.com… …命令如何从DockerHub中提取四个超级账本容器映像，然后启动它们。这些容器拥有用于这些超级账本组件的软件的最新版本。请随意探索basic-network目录——在本教程中，我们将使用它的大部分内容。</p>
<p>您可以使用docker ps命令列出运行基本网络组件的docker容器</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker ps

CONTAINER ID        IMAGE                        COMMAND                  CREATED              STATUS              PORTS                                            NAMES
ada3d078989b        hyperledger/fabric-peer      &quot;peer node start&quot;        About a minute ago   Up About a minute   0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
1fa1fd107bfb        hyperledger/fabric-orderer   &quot;orderer&quot;                About a minute ago   Up About a minute   0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
53fe614274f7        hyperledger/fabric-couchdb   &quot;tini -- /docker-ent…&quot;   About a minute ago   Up About a minute   4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb
469201085a20        hyperledger/fabric-ca        &quot;sh -c &#39;fabric-ca-se…&quot;   About a minute ago   Up About a minute   0.0.0.0:7054-&gt;7054/tcp                           ca.example.com
</pre></div>
</div>
<p>看看你是否可以将这些容器映射到基本网络(你可能需要水平滚动来定位信息):</p>
<ul class="simple">
<li><p>A peer <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">ada3d078989b</span></code></p></li>
<li><p>An orderer <code class="docutils literal notranslate"><span class="pre">orderer.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">1fa1fd107bfb</span></code></p></li>
<li><p>A CouchDB database <code class="docutils literal notranslate"><span class="pre">couchdb</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">53fe614274f7</span></code></p></li>
<li><p>A CA <code class="docutils literal notranslate"><span class="pre">ca.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">469201085a20</span></code></p></li>
</ul>
<p>这些容器都来自一个名为net_basic的docker网络。您可以使用docker network命令查看网络:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker network inspect net_basic

    {
        &quot;Name&quot;: &quot;net_basic&quot;,
        &quot;Id&quot;: &quot;62e9d37d00a0eda6c6301a76022c695f8e01258edaba6f65e876166164466ee5&quot;,
        &quot;Created&quot;: &quot;2018-11-07T13:46:30.4992927Z&quot;,
        &quot;Containers&quot;: {
            &quot;1fa1fd107bfbe61522e4a26a57c2178d82b2918d5d423e7ee626c79b8a233624&quot;: {
                &quot;Name&quot;: &quot;orderer.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.4/16&quot;,
            },
            &quot;469201085a20b6a8f476d1ac993abce3103e59e3a23b9125032b77b02b715f2c&quot;: {
                &quot;Name&quot;: &quot;ca.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.2/16&quot;,
            },
            &quot;53fe614274f7a40392210f980b53b421e242484dd3deac52bbfe49cb636ce720&quot;: {
                &quot;Name&quot;: &quot;couchdb&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.3/16&quot;,
            },
            &quot;ada3d078989b568c6e060fa7bf62301b4bf55bed8ac1c938d514c81c42d8727a&quot;: {
                &quot;Name&quot;: &quot;peer0.org1.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.5/16&quot;,
            }
        },
        &quot;Labels&quot;: {}
    }
</pre></div>
</div>
<p>查看作为单个docker网络的一部分，这四个容器如何使用不同的IP地址。(为了清晰起见，我们将输出缩短了。)</p>
<p>回顾一下:您已经从GitHub下载了Hyperledger Fabric样例库，并且已经在本地机器上运行了基本网络。现在让我们开始扮演磁石公司的角色，他们希望交易商业票据。</p>
</div>
<div class="section" id="working-as-magnetocorp">
<h2>Working as MagnetoCorp<a class="headerlink" href="#working-as-magnetocorp" title="永久链接至标题">¶</a></h2>
<p>要监视PaperNet的MagnetoCorp组件，管理员可以使用logspout工具查看一组docker容器的聚合输出。它将不同的输出流收集到一个地方，这样就可以很容易地从一个窗口看到发生了什么。这对于管理员在安装智能合约或开发人员在调用智能合约时非常有用。</p>
<p>现在让我们以MagnetoCorp管理员的身份监视PaperNet。打开fabric-samples目录中的一个新窗口，找到并运行monitordocker.sh脚本，用来启动与docker网络net_basic关联的PaperNet docker容器的logspout工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ cd commercial-paper/organization/magnetocorp/configuration/cli/
(magnetocorp admin)$ ./monitordocker.sh net_basic
...
latest: Pulling from gliderlabs/logspout
4fe2ade4980c: Pull complete
decca452f519: Pull complete
(...)
Starting monitoring on all containers on the network net_basic
b7f3586e5d0233de5a454df369b8eadab0613886fc9877529587345fc01a3582
</pre></div>
</div>
<p>注意，如果monitordocker.sh中的默认端口已经在使用，那么可以将端口号传递给上面的命令。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ ./monitordocker.sh net_basic &lt;port_number&gt;
</pre></div>
</div>
<p>这个窗口现在将显示docker容器的输出，所以让我们启动另一个终端窗口，它将允许MagnetoCorp管理员与网络交互。</p>
<p><img alt="../_images/commercial_paper.diagram.4.png" src="../_images/commercial_paper.diagram.4.png" />commercialpaper.workmagneto <em>A MagnetoCorp
administrator interacts with the network via a docker container.</em></p>
<p>为了与PaperNet交互，MagnetoCorp管理员需要使用超级账本peer命令。方便的是，这些都可以在hyperledger/fabric-tools docker镜像中预先构建。</p>
<p>让我们使用docker-compose命令为管理员启动一个特定于magnetocorp的docker容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ cd commercial-paper/organization/magnetocorp/configuration/cli/
(magnetocorp admin)$ docker-compose -f docker-compose.yml up -d cliMagnetoCorp

Pulling cliMagnetoCorp (hyperledger/fabric-tools:)...
latest: Pulling from hyperledger/fabric-tools
3b37166ec614: Already exists
(...)
Digest: sha256:058cff3b378c1f3ebe35d56deb7bf33171bf19b327d91b452991509b8e9c7870
Status: Downloaded newer image for hyperledger/fabric-tools:latest
Creating cliMagnetoCorp ... done
</pre></div>
</div>
<p>再次，查看如何从Docker Hub检索到hyperledger/fabric-tools docker镜像并添加到网络中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker ps

CONTAINER ID        IMAGE                        COMMAND                  CREATED              STATUS              PORTS                                            NAMES
562a88b25149        hyperledger/fabric-tools     &quot;/bin/bash&quot;              About a minute ago   Up About a minute                                                    cliMagnetoCorp
b7f3586e5d02        gliderlabs/logspout          &quot;/bin/logspout&quot;          7 minutes ago        Up 7 minutes        127.0.0.1:8000-&gt;80/tcp                           logspout
ada3d078989b        hyperledger/fabric-peer      &quot;peer node start&quot;        29 minutes ago       Up 29 minutes       0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
1fa1fd107bfb        hyperledger/fabric-orderer   &quot;orderer&quot;                29 minutes ago       Up 29 minutes       0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
53fe614274f7        hyperledger/fabric-couchdb   &quot;tini -- /docker-ent…&quot;   29 minutes ago       Up 29 minutes       4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb
469201085a20        hyperledger/fabric-ca        &quot;sh -c &#39;fabric-ca-se…&quot;   29 minutes ago       Up 29 minutes       0.0.0.0:7054-&gt;7054/tcp                           ca.example.com
</pre></div>
</div>
<p>MagnetoCorp管理员将使用容器562a88b25149中的命令行与PaperNet交互。还要注意logspout容器b7f3586e5d02;这是为monitordocker.sh命令捕获所有其他docker容器的输出。</p>
<p>现在让我们使用这个命令行作为MagnetoCorp管理员与PaperNet进行交互。</p>
</div>
<div class="section" id="smart-contract">
<h2>Smart contract<a class="headerlink" href="#smart-contract" title="永久链接至标题">¶</a></h2>
<p>issue、buy和redeem是PaperNet智能合同的三个核心功能。它被应用于在账本上提交发行、购买和赎回商业票据的交易。我们的下一个任务是研究这个智能合约。</p>
<p>打开一个代表MagnetoCorp开发人员的新终端窗口，并切换到包含MagnetoCorp的智能合约副本的目录，使用您选择的编辑器查看它(本教程中使用VS Code):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp developer)$ cd commercial-paper/organization/magnetocorp/contract
(magnetocorp developer)$ code .
</pre></div>
</div>
<p>在文件夹的lib目录中，您将看到papercontract.js文件——它包含了商业票据的智能合约!</p>
<p><img alt="../_images/commercial_paper.diagram.10.png" src="../_images/commercial_paper.diagram.10.png" />commercialpaper.vscode1 <em>An example code
editor displaying the commercial paper smart contract in <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code></em></p>
<p>papercontract.js是一个JavaScript程序，设计用于运行在node.js环境中。注意以下关键程序行:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">{</span> <span class="pre">Contract,</span> <span class="pre">Context</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">require('fabric-contract-api');</span></code></p>
<p>This statement brings into scope two key Hyperledger Fabric classes that will
be used extensively by the smart contract  – <code class="docutils literal notranslate"><span class="pre">Contract</span></code> and <code class="docutils literal notranslate"><span class="pre">Context</span></code>. You
can learn more about these classes in the
<a class="reference external" href="https://fabric-shim.github.io/"><code class="docutils literal notranslate"><span class="pre">fabric-shim</span></code> JSDOCS</a>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">CommercialPaperContract</span> <span class="pre">extends</span> <span class="pre">Contract</span> <span class="pre">{</span></code></p>
<p>This defines the smart contract class <code class="docutils literal notranslate"><span class="pre">CommercialPaperContract</span></code> based on the
built-in Fabric <code class="docutils literal notranslate"><span class="pre">Contract</span></code> class.  The methods which implement the key
transactions to <code class="docutils literal notranslate"><span class="pre">issue</span></code>, <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> commercial paper are defined
within this class.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">issue(ctx,</span> <span class="pre">issuer,</span> <span class="pre">paperNumber,</span> <span class="pre">issueDateTime,</span> <span class="pre">maturityDateTime...)</span> <span class="pre">{</span></code></p>
<p>This method defines the commercial paper <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction for PaperNet. The
parameters that are passed to this method will be used to create the new
commercial paper.</p>
<p>Locate and examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transactions within the smart
contract.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">paper</span> <span class="pre">=</span> <span class="pre">CommercialPaper.createInstance(issuer,</span> <span class="pre">paperNumber,</span> <span class="pre">issueDateTime...);</span></code></p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction, this statement creates a new commercial paper
in memory using the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> class with the supplied transaction
inputs. Examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transactions to see how they similarly
use this class.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">ctx.paperList.addPaper(paper);</span></code></p>
<p>This statement adds the new commercial paper to the ledger using
<code class="docutils literal notranslate"><span class="pre">ctx.paperList</span></code>, an instance of a <code class="docutils literal notranslate"><span class="pre">PaperList</span></code> class that was created when the
smart contract context <code class="docutils literal notranslate"><span class="pre">CommercialPaperContext</span></code> was initialized. Again,
examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> methods to see how they use this class.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">paper.toBuffer();</span></code></p>
<p>This statement returns a binary buffer as response from the <code class="docutils literal notranslate"><span class="pre">issue</span></code>
transaction for processing by the caller of the smart contract.</p>
</li>
</ul>
<p>请随意查看合同目录中的其他文件，以了解智能合约是如何工作的，并在智能合约主题中详细阅读papercontract.js是如何设计的。</p>
</div>
<div class="section" id="install-contract">
<h2>Install contract<a class="headerlink" href="#install-contract" title="永久链接至标题">¶</a></h2>
<p>在应用程序调用papercontract之前，必须将其安装到PaperNet中适当的peer节点上。磁石集团(MagnetoCorp)和数字银行(DigiBank)的管理人员可以向各自拥有权限的peer节点上安装papercontract。</p>
<p><img alt="../_images/commercial_paper.diagram.6.png" src="../_images/commercial_paper.diagram.6.png" />commercialpaper.install <em>A MagnetoCorp
administrator installs a copy of the <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> onto a MagnetoCorp peer.</em></p>
<p>智能合约是应用程序开发的重点，它包含在一个名为chaincode的超级账本构件中。一个或多个智能合约可以在一个链码中定义，安装一个链码将允许PaperNet中的不同组织使用它们。这意味着只有管理员才需要担心链码;每个人都可以用智能合约来行事。</p>
<p>MagnetoCorp管理员使用peer chaincode install命令将papercontract智能合约从本地机器的文件系统复制到目标peer节点的docker容器中的文件系统。一旦智能合约安装在peer节点上并在通道上实例化，应用程序就可以调用papercontract，并通过putState()和getState() 这样的Fabric APIs与账本数据库交互。检查这些api是如何被ledger-apistate .js中的StateList类使用的。</p>
<p>现在让我们以MagnetoCorp管理员的身份安装papercontract。在MagnetoCorp administrator的命令窗口中，使用docker exec命令在cliMagnetCorp容器中运行peer chaincode install命令:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker exec cliMagnetoCorp peer chaincode install -n papercontract -v 0 -p /opt/gopath/src/github.com/contract -l node

2018-11-07 14:21:48.400 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-11-07 14:21:48.400 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-11-07 14:21:48.466 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;
</pre></div>
</div>
<p>cliMagnetCorp容器已经将CORE_PEER_ADDRESS=peer0.org1.example.com:7051设置为将其命令指向peer0.org1.example.com，并且远程安装了INFO 003…表明papercontract已成功安装到此peer节点。目前，MagentoCorp的管理人员只需在MagentoCorp的一个peer节点上安装一份papercontract合约。</p>
<p>请注意peer chaincode install命令如何指定智能合约的路径，-p，与cliMagnetoCorp容器的文件系统相关: /opt/gopath/src/github.com/contract。此路径已映射到本地文件系统路径…/organization/magnetocorp/contract。通过magnetocorp/configuration/cli/docker-compose.yml文件:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./../../../../organization/magnetocorp:/opt/gopath/src/github.com/</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>查看volume指令如何将 organization/magnetocorp映射到/opt/gopath/src/github.com/，从而提供对本地文件系统的容器访问，其中保存了magnetocorp的papercontract智能合约副本。</p>
<p>您可以在这里阅读更多关于docker compose和peer chaincode install 命令。</p>
</div>
<div class="section" id="instantiate-contract">
<h2>Instantiate contract<a class="headerlink" href="#instantiate-contract" title="永久链接至标题">¶</a></h2>
<p>现在，包含商业票据智能合约的papercontract链码已安装在所需的PaperNet的peer节点上，管理员可以将其提供给不同的网络通道，以便连接到这些通道的应用程序可以调用它。因为我们使用的是PaperNet的基本网络配置，所以我们只在一个网络通道mychannel中提供papercontract。</p>
<p><img alt="../_images/commercial_paper.diagram.7.png" src="../_images/commercial_paper.diagram.7.png" />commercialpaper.instant <em>A MagnetoCorp
administrator instantiates <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> chaincode containing the smart
contract. A new docker chaincode container will be created to run
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code>.</em></p>
<p>MagnetoCorp管理员使用peer chaincode instantiate命令在mychannel上实例化papercontract:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker exec cliMagnetoCorp peer chaincode instantiate -n papercontract -v 0 -l node -c &#39;{&quot;Args&quot;:[&quot;org.papernet.commercialpaper:instantiate&quot;]}&#39; -C mychannel -P &quot;AND (&#39;Org1MSP.member&#39;)&quot;

2018-11-07 14:22:11.162 UTC [chaincodeCmd] InitCmdFactory -&gt; INFO 001 Retrieved channel (mychannel) orderer endpoint: orderer.example.com:7050
2018-11-07 14:22:11.163 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default escc
2018-11-07 14:22:11.163 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default vscc
</pre></div>
</div>
<p>这个命令可能需要几分钟才能完成。</p>
<p>实例化中最重要的参数之一是-P。它指定了papercontract的背书策略，描述了一组必须在确定交易有效之前对其进行背书(执行和签署)的组织。所有的交易，无论是有效的还是无效的，都将被记录在账本区块链上，但是只有有效的交易才会更新世界状态。</p>
<p>在传递过程中，请查看实例化如何传递orderer地址orderer.example.com:7050。这是因为它还向orderer提交了一个实例化事务，orderer将在下一个块中包含该事务，并将该事务分发给已经加入mychannel的所有peer，从而使任何peer都能够在自己的隔离的chaincode容器中执行chaincode。注意，实例化只需要在papercontract将运行的通道发出一次，即使它通常安装在许多peer节点上。</p>
<p>使用docker ps命令查看一个papercontract容器如何被启动:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker ps

CONTAINER ID        IMAGE                                              COMMAND                  CREATED             STATUS              PORTS          NAMES
4fac1b91bfda        dev-peer0.org1.example.com-papercontract-0-d96...  &quot;/bin/sh -c &#39;cd /usr…&quot;   2 minutes ago       Up 2 minutes                       dev-peer0.org1.example.com-papercontract-0
</pre></div>
</div>
<p>注意，容器名为dev-peer0.org1.example.com-papercontract-0-d96…以指示是哪个peer节点启动了它，以及它正在运行papercontract version 0。</p>
<p>现在我们已经建立并运行了一个基本的PaperNet，并且安装并实例化了papercontract，接下来让我们将注意力转向MagnetoCorp应用程序，它发行了一份商业票据。</p>
</div>
<div class="section" id="application-structure">
<h2>Application structure<a class="headerlink" href="#application-structure" title="永久链接至标题">¶</a></h2>
<p>包含在papercontract中的智能合约被称为MagnetoCorp的应用 issue.js。Isabella使用此应用程序向账本发出一笔交易，发行商业票据00001。让我们快速研究一下发行应用程序是如何工作的。</p>
<p><img alt="../_images/commercial_paper.diagram.8.png" src="../_images/commercial_paper.diagram.8.png" />commercialpaper.application <em>A gateway
allows an application to focus on transaction generation, submission and
response. It coordinates transaction proposal, ordering and notification
processing between the different network components.</em></p>
<p>由于发行应用程序代表Isabella提交事务，它首先从Isabella的钱包中检索Isabella的X.509证书，该证书可能存储在本地文件系统或硬件安全模块HSM中。然后，发行应用程序可以利用网关在通道上提交事务。Hyperledger Fabric SDK提供了一个抽象网关，这样应用程序可以在将网络交互委托给网关的同时专注于应用程序逻辑。网关和钱包使编写超级账应用程序变得很简单。</p>
<p>让我们来看看伊莎贝拉将要使用的发行应用程序。为她打开一个单独的终端窗口，在fabric-samples中找到MagnetoCorp /application文件夹:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ cd commercial-paper/organization/magnetocorp/application/
(magnetocorp user)$ ls

addToWallet.js		issue.js		package.json
</pre></div>
</div>
<p>addToWalle.js是Isabella将用来将她的身份载入钱包的程序，而publish.js将通过调用papercontract来使用这个身份来代表MagnetoCorp创建商业票据00001。</p>
<p>更改为包含MagnetoCorp的应用程序issue.js的副本目录。，并使用你的代码编辑器来检查它:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ cd commercial-paper/organization/magnetocorp/application
(magnetocorp user)$ code issue.js
</pre></div>
</div>
<p>检查该目录;它包含发行应用程序及其所有依赖项。</p>
<p><img alt="../_images/commercial_paper.diagram.11.png" src="../_images/commercial_paper.diagram.11.png" />commercialpaper.vscode2 <em>A code editor
displaying the contents of the commercial paper application directory.</em></p>
<p>注意issue.js中的以下关键程序行:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">{</span> <span class="pre">FileSystemWallet,</span> <span class="pre">Gateway</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">require('fabric-network');</span></code></p>
<p>This statement brings two key Hyperledger Fabric SDK classes into scope –
<code class="docutils literal notranslate"><span class="pre">Wallet</span></code> and <code class="docutils literal notranslate"><span class="pre">Gateway</span></code>. Because Isabella’s X.509 certificate is in the local
file system, the application uses <code class="docutils literal notranslate"><span class="pre">FileSystemWallet</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">wallet</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">FileSystemWallet('../identity/user/isabella/wallet');</span></code></p>
<p>This statement identifies that the application will use <code class="docutils literal notranslate"><span class="pre">isabella</span></code> wallet when
it connects to the blockchain network channel. The application will select a
particular identity within <code class="docutils literal notranslate"><span class="pre">isabella</span></code> wallet. (The wallet must have been
loaded with the Isabella’s X.509 certificate – that’s what <code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code>
does.)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">gateway.connect(connectionProfile,</span> <span class="pre">connectionOptions);</span></code></p>
<p>This line of code connects to the network using the gateway identified by
<code class="docutils literal notranslate"><span class="pre">connectionProfile</span></code>, using the identity referred to in <code class="docutils literal notranslate"><span class="pre">ConnectionOptions</span></code>.</p>
<p>See how <code class="docutils literal notranslate"><span class="pre">../gateway/networkConnection.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">User1&#64;org1.example.com</span></code> are
used for these values respectively.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">network</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">gateway.getNetwork('mychannel');</span></code></p>
<p>This connects the application to the network channel <code class="docutils literal notranslate"><span class="pre">mychannel</span></code>, where the
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code> was previously instantiated.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">contract</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">network.getContract('papercontract',</span> <span class="pre">'org.papernet.comm...');</span></code></p></li>
</ul>
<p>此语句使应用程序可寻址到papercontract中的命名空间org.papernet.commercial alpaper定义的智能合约。一旦应用程序发出getContract，它就可以提交在其中实现的任何事务。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">issueResponse</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">contract.submitTransaction('issue',</span> <span class="pre">'MagnetoCorp',</span> <span class="pre">'00001'...);</span></code></p>
<p>This line of code submits the a transaction to the network using the <code class="docutils literal notranslate"><span class="pre">issue</span></code>
transaction defined within the smart contract. <code class="docutils literal notranslate"><span class="pre">MagnetoCorp</span></code>, <code class="docutils literal notranslate"><span class="pre">00001</span></code>… are
the values to be used by the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction to create a new commercial
paper.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">paper</span> <span class="pre">=</span> <span class="pre">CommercialPaper.fromBuffer(issueResponse);</span></code></p>
<p>This statement processes the response from the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction. The
response needs to deserialized from a buffer into <code class="docutils literal notranslate"><span class="pre">paper</span></code>, a <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code>
object which can interpreted correctly by the application.</p>
</li>
</ul>
<p>请随意检查/application目录中的其他文件，以了解issue.js是如何工作的，并详细阅读它在应用程序主题中是如何实现的</p>
</div>
<div class="section" id="application-dependencies">
<h2>Application dependencies<a class="headerlink" href="#application-dependencies" title="永久链接至标题">¶</a></h2>
<p>issues.js应用程序是用JavaScript编写的，设计运行在node.js环境中，充当PaperNet网络的客户端。与通常的做法一样，MagnetoCorp的应用程序构建在许多外部节点包之上——以提高开发的质量和速度。考虑一下problem.js是如何包含js-yaml包来处理YAML网关连接概要文件的，或者包含fabric-network包来访问网关和钱包类的:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">yaml</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;js-yaml&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">FileSystemWallet</span><span class="p">,</span> <span class="nx">Gateway</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fabric-network&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>必须使用npm install命令将这些包从npm下载到本地文件系统。按照惯例，必须将包安装到应用程序相关/node_modules目录中，以便在运行时使用。</p>
<p>检查包装。查看issue.js如何识别要下载的包及其确切版本:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>  &quot;dependencies&quot;: {
    &quot;fabric-network&quot;: &quot;~1.4.0&quot;,
    &quot;fabric-client&quot;: &quot;~1.4.0&quot;,
    &quot;js-yaml&quot;: &quot;^3.12.0&quot;
  },
</pre></div>
</div>
<p>npm版本控制非常强大;你可以在这里阅读更多。</p>
<p>让我们用npm install命令安装这些包——这可能需要一分钟来完成:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ cd commercial-paper/organization/magnetocorp/application/
(magnetocorp user)$ npm install

(           ) extract:lodash: sill extract ansi-styles@3.2.1
(...)
added 738 packages in 46.701s
</pre></div>
</div>
<p>查看此命令如何更新目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ ls

addToWallet.js		node_modules	      	package.json
issue.js	      	package-lock.json
</pre></div>
</div>
<p>检查node_modules目录，查看已安装的包。有很多，因为js-yaml和fabric-network本身是建立在其他npm包之上的!有助的是，package_json文件标识所安装的确切版本，如果您想准确地重现环境，这将是非常宝贵的;例如，测试、诊断问题或交付经过验证的应用程序。</p>
</div>
<div class="section" id="wallet">
<h2>Wallet<a class="headerlink" href="#wallet" title="永久链接至标题">¶</a></h2>
<p>伊莎贝拉几乎准备好运行issue.js发行MagnetoCorp商业票据00001,只剩一项任务要做了!issue.js代表伊莎贝拉，因此磁石公司将使用她钱包里的身份来反映这些事实。现在，我们需要执行这个一次性活动，将适当的X.509凭证添加到她的钱包中。</p>
<p>在Isabella的终端窗口中，运行addToWallet.js程序将身份信息添加到她的钱包中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ node addToWallet.js

done
</pre></div>
</div>
<p>Isabella可以在她的钱包中存储多个身份，但是在我们的示例中，她只使用一个——<a class="reference external" href="mailto:User1&#37;&#52;&#48;org&#46;example&#46;com">User1<span>&#64;</span>org<span>&#46;</span>example<span>&#46;</span>com</a>。这个身份目前与现在的基本网络相关，而不是更实际的PaperNet配置——我们将很快更新本教程。</p>
<p>addToWallet.js是一个简单的文件复制程序，您可以在空闲时查看。它从基本网络移动一个身份样本到Isabella的钱包。让我们关注一下这个程序的结果——用于向PaperNet提交交易的钱包的内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls ../identity/user/isabella/wallet/

User1@org1.example.com
</pre></div>
</div>
<p>查看目录结构如何映射User1&#64;org1.example.com身份标识——Isabella使用的其他标识将拥有自己的文件夹。在这个目录中，您将找到issue.js将代表isabella使用的身份信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls ../identity/user/isabella/wallet/User1@org1.example.com

User1@org1.example.com      c75bd6911a...-priv      c75bd6911a...-pub
</pre></div>
</div>
<p>注意：</p>
<ul>
<li><p>a private key <code class="docutils literal notranslate"><span class="pre">c75bd6911a...-priv</span></code> used to sign transactions on Isabella’s
behalf, but not distributed outside of her immediate control.</p></li>
<li><p>a public key <code class="docutils literal notranslate"><span class="pre">c75bd6911a...-pub</span></code> which is cryptographically linked to
Isabella’s private key. This is wholly contained within Isabella’s X.509
certificate.</p></li>
<li><p>a certificate <code class="docutils literal notranslate"><span class="pre">User1&#64;org.example.com</span></code> which contains Isabella’s public key
and other X.509 attributes added by the Certificate Authority at certificate
creation. This certificate is distributed to the network so that different
actors at different times can cryptographically verify information created by
Isabella’s private key.</p>
<p>Learn more about certificates
<a class="reference external" href="../identity/identity.html#digital-certificates">here</a>. In practice, the
certificate file also contains some Fabric-specific metadata such as
Isabella’s organization and role – read more in the
<a class="reference external" href="../developapps/wallet.html">wallet</a> topic.</p>
</li>
</ul>
</div>
<div class="section" id="issue-application">
<h2>Issue application<a class="headerlink" href="#issue-application" title="永久链接至标题">¶</a></h2>
<p>Isabella现在可以使用issue.js提交一笔交易，该交易将发行MagnetoCorp的商业票据00001:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ node issue.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper issue transaction.
Process issue transaction response.
MagnetoCorp commercial paper : 00001 successfully issued for value 5000000
Transaction complete.
Disconnect from Fabric gateway.
Issue program complete.
</pre></div>
</div>
<p>node命令初始化node.js环境，并运行issue.js。从程序输出可以看出，MagnetoCorp 商业票据 00001发行的面值为500万美元。</p>
<p>如您所见，为了实现这一点，应用程序调用papercontract.js中的CommercialPaper智能合约中定义的发行事务。这是由MagnetoCorp管理员在网络中安装和实例化的。智能合约通过Fabric api与分类账本交互，最显著的是putState()和getState()，以表示新的商业票据作为世界状态中的向量状态。我们将看到这个向量状态是如何被smart合约中定义的buy和redeem事务控制的。</p>
<p>底层Fabric SDK始终处理事务背书、排序和通知过程，使应用程序的逻辑更加直观;SDK使用网关来抽象网络细节，connectionOptions来声明更高级的处理策略，比如事务重试。</p>
<p>现在让我们跟随MagnetoCorp 00001的生命周期，将重点转向购买商业票据的DigiBank。</p>
</div>
<div class="section" id="working-as-digibank">
<h2>Working as DigiBank<a class="headerlink" href="#working-as-digibank" title="永久链接至标题">¶</a></h2>
<p>现在商业票据00001已经由MagnetoCorp发行，让我们切换上下文，作为DigiBank的员工与PaperNet进行交互。首先，我们将作为管理员创建一个配置为与PaperNet交互的控制台。然后，终端用户Balaji将使用Digibank的buy应用程序购买商业票据00001，将其移动到生命周期的下一个阶段。</p>
<p><img alt="../_images/commercial_paper.diagram.5.png" src="../_images/commercial_paper.diagram.5.png" />commercialpaper.workdigi <em>DigiBank
administrators and applications interact with the PaperNet network.</em></p>
<p>由于本教程目前使用的是PaperNet的基本网络，所以网络配置非常简单。管理员使用类似于MagnetoCorp的控制台，但配置为Digibank的文件系统。同样，digbank终端用户将使用与MagnetoCorp应用程序调用相同智能合约的应用程序，尽管它们包含的是digbank的逻辑和配置。智能合约捕获共享的业务流程，而分类账保存共享的业务数据，无论哪个应用程序调用它们。</p>
<p>让我们打开一个单独的终端，允许DigiBank管理员与PaperNet交互。在 fabric-samples中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(digibank admin)$ cd commercial-paper/organization/digibank/configuration/cli/
(digibank admin)$ docker-compose -f docker-compose.yml up -d cliDigiBank

(...)
Creating cliDigiBank ... done
</pre></div>
</div>
<p>Digibank银行管理人员现在可以使用这个docker容器与网络进行互动:</p>
<div class="highlight-(digibank admin)$ docker ps notranslate"><div class="highlight"><pre><span></span>CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORT         NAMES
858c2d2961d4        hyperledger/fabric-tools         &quot;/bin/bash&quot;              18 seconds ago      Up 18 seconds                    cliDigiBank
</pre></div>
</div>
<p>在本教程中，您将使用名为cliDigiBank的命令行容器代表DigiBank与网络进行交互。我们还没有显示所有docker容器，在现实世界中，digbank用户只能看到他们可以访问的网络组件(peers、orderers、ca)。</p>
<p>由于PaperNet网络配置非常简单，所以digbank的管理员目前在本教程中没有什么要做的。让我们把注意力转向Balaji。</p>
</div>
<div class="section" id="digibank-applications">
<h2>Digibank applications<a class="headerlink" href="#digibank-applications" title="永久链接至标题">¶</a></h2>
<p>Balaji使用DigiBank的buy应用程序向超级账本提交一笔交易，该账本将商业票据00001的所有权从MagnetoCorp转移到DigiBank。商业票据智能合约与MagnetoCorp的应用程序使用的合约是一样的，但这次的交易不同——它是购买而不是发行。让我们来看看DigiBank的应用程序是如何工作的。</p>
<p>为Balaji打开一个单独的终端窗口。在fabric-samples中，切换到包含buy.js程序的DigiBank应用程序目录。然后用编辑器打开:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ cd commercial-paper/organization/digibank/application/
(balaji)$ code buy.js
</pre></div>
</div>
<p>如您所见，这个目录包含Balaji将使用的buy和redeem应用程序。</p>
<p><img alt="../_images/commercial_paper.diagram.12.png" src="../_images/commercial_paper.diagram.12.png" />commercialpaper.vscode3 <em>DigiBank’s
commercial paper directory containing the <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem.js</span></code>
applications.</em></p>
<p>DigiBank的buy.js应用程序在结构上与MagnetoCorp的issue.js非常相似，除了两点不同：</p>
<ul>
<li><p><strong>Identity</strong>: the user is a DigiBank user <code class="docutils literal notranslate"><span class="pre">Balaji</span></code> rather than MagnetoCorp’s
<code class="docutils literal notranslate"><span class="pre">Isabella</span></code></p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileSystemWallet</span><span class="p">(</span><span class="s1">&#39;../identity/user/balaji/wallet&#39;</span><span class="p">);</span><span class="sb">`</span>
</pre></div>
</div>
<p>See how the application uses the <code class="docutils literal notranslate"><span class="pre">balaji</span></code> wallet when it connects to the
PaperNet network channel. <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> selects a particular identity within
<code class="docutils literal notranslate"><span class="pre">balaji</span></code> wallet.</p>
</li>
<li><p><strong>Transaction</strong>: the invoked transaction is <code class="docutils literal notranslate"><span class="pre">buy</span></code> rather than <code class="docutils literal notranslate"><span class="pre">issue</span></code></p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="sb">`const buyResponse = await contract.submitTransaction(&#39;buy&#39;, &#39;MagnetoCorp&#39;, &#39;00001&#39;...);`</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">buy</span></code> transaction is submitted with the values <code class="docutils literal notranslate"><span class="pre">MagnetoCorp</span></code>, <code class="docutils literal notranslate"><span class="pre">00001</span></code>…,
that are used by the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart contract class to transfer
ownership of commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> to DigiBank.</p>
</li>
</ul>
<p>请随意检查应用程序目录中的其他文件，以了解应用程序如何工作，并详细阅读应用程序主题中buy.js是如何实现的。</p>
</div>
<div class="section" id="run-as-digibank">
<h2>Run as DigiBank<a class="headerlink" href="#run-as-digibank" title="永久链接至标题">¶</a></h2>
<p>购买和赎回商业票据的DigiBank应用程序与MagnetoCorp的发行应用程序具有非常相似的结构。因此，让我们安装它们的依赖项并设置Balaji的钱包，这样他就可以使用这些应用程序购买和赎回商业票据。</p>
<p>与MagnetoCorp一样，Digibank必须使用npm install命令安装所需的应用程序包，同样，这需要很短的时间来完成。</p>
<p>在 DigiBank 的管理员窗口下，安装应用程式的依赖项:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(digibank admin)$ cd commercial-paper/organization/digibank/application/
(digibank admin)$ npm install

(            ) extract:lodash: sill extract ansi-styles@3.2.1
(...)
added 738 packages in 46.701s
</pre></div>
</div>
<p>在Balaji的终端窗口，运行addToWallet.js程序，将身份信息添加到他的钱包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node addToWallet.js

done
</pre></div>
</div>
<p>addToWallet.js程序将balaji的身份信息添加到他的钱包中，buy.js和redeemm .js将使用该钱包向PaperNet提交交易。</p>
<p>和Isabella一样，Balaji可以在他的钱包中存储多个身份，但是在我们的示例中，他只使用一个——<a class="reference external" href="mailto:Admin&#37;&#52;&#48;org&#46;example&#46;com">Admin<span>&#64;</span>org<span>&#46;</span>example<span>&#46;</span>com</a>。他相应的钱包结构digbank <a class="reference external" href="mailto:/identity/user/balaji/wallet/Admin&#37;&#52;&#48;org1&#46;example">/identity/user/balaji/wallet/Admin<span>&#64;</span>org1<span>&#46;</span>example</a>.com包含的与Isabella的非常相似——请随意查看。</p>
</div>
<div class="section" id="buy-application">
<h2>Buy application<a class="headerlink" href="#buy-application" title="永久链接至标题">¶</a></h2>
<p>Balaji现在可以使用buy.js提交一笔交易，该交易将把MagnetoCorp商业票据00001的所有权转让给DigiBank。</p>
<p>在Balaji的窗口中运行buy应用程序:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node buy.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper buy transaction.
Process buy transaction response.
MagnetoCorp commercial paper : 00001 successfully purchased by DigiBank
Transaction complete.
Disconnect from Fabric gateway.
Buy program complete.
</pre></div>
</div>
<p>您可以看到程序输出，MagnetoCorp commercial paper 00001被代表DigiBank的Balaji成功购买。js调用了businessalpaper smart contract中定义的buy事务，该事务使用putState()和getState() Fabric api在世界范围内更新了商业票据00001。正如您所看到的，购买和发行商业票据的应用程序逻辑非常类似，智能合约逻辑也是如此。</p>
</div>
<div class="section" id="redeem-application">
<h2>Redeem application<a class="headerlink" href="#redeem-application" title="永久链接至标题">¶</a></h2>
<p>商业票据00001生命周期的最后一笔交易是由DigiBank与MagnetoCorp进行赎回。Balaji使用redeem.js提交事务来执行smart合约中的赎回逻辑。</p>
<p>在Balaji的窗口中运行赎回交易:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node redeem.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper redeem transaction.
Process redeem transaction response.
MagnetoCorp commercial paper : 00001 successfully redeemed with MagnetoCorp
Transaction complete.
Disconnect from Fabric gateway.
Redeem program complete.
</pre></div>
</div>
<p>再次，请查看当redeem.js调用commercial paper中定义的赎回事务时，商业票据00001是如何成功赎回的。再次，它更新了世界范围内的商业票据00001，以反映所有权回到了发行该票据的MagnetoCorp。</p>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="永久链接至标题">¶</a></h2>
<p>要更详细地了解本教程中显示的应用程序和智能合约是如何工作的，您将发现阅读开发应用程序很有帮助。本主题将更全面地解释商业票据场景、PaperNet业务网络及其参与者，以及它们使用的应用程序和智能契约如何工作。</p>
<p>也可以使用这个示例开始创建您自己的应用程序和智能合约!</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../build_network.html" class="btn btn-neutral float-right" title="搭建你的第一个网络（BYFN）" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../write_first_app.html" class="btn btn-neutral" title="Writing Your First Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>