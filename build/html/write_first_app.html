

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Your First Application &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Commercial paper tutorial" href="tutorial/commercial_paper.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s new in the v2.0 Alpha</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing Your First Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-up-the-blockchain-network">Set up the blockchain network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#launch-the-network">Launch the network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-application">Install the application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enrolling-the-admin-user">Enrolling the admin user</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register-and-enroll-user1">Register and enroll <code class="docutils literal notranslate"><span class="pre">user1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-the-ledger">Querying the ledger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-fabcar-smart-contract">The FabCar smart contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-ledger">Updating the ledger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-resources">Additional resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/commercial_paper.html">Commercial paper tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_network.html">Building Your First Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="private_data_tutorial.html">Using Private Data in Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Writing Your First Application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/write_first_app.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-your-first-application">
<h1>Writing Your First Application<a class="headerlink" href="#writing-your-first-application" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re not yet familiar with the fundamental architecture of a
Fabric network, you may want to visit the <a class="reference internal" href="key_concepts.html"><span class="doc">Key Concepts</span></a> section
prior to continuing.</p>
<p>It is also worth noting that this tutorial serves as an introduction
to Fabric applications and uses simple smart contracts and
applications. For a more in-depth look at Fabric applications and
smart contracts, check out our
<a class="reference internal" href="developapps/developing_applications.html"><span class="doc">Developing Applications</span></a> section or the
<a class="reference internal" href="tutorial/commercial_paper.html"><span class="doc">Commercial paper tutorial</span></a>.</p>
</div>
<p>In this tutorial we’ll be looking at a handful of sample programs to see how
Fabric apps work. These applications and the smart contracts they use are
collectively known as <code class="docutils literal notranslate"><span class="pre">FabCar</span></code>. They provide a great starting point to
understand a Hyperledger Fabric blockchain. You’ll learn how to write an
application and smart contract to query and update a ledger, and how to use a
Certificate Authority to generate the X.509 certificates used by applications
which interact with a permissioned blockchain.</p>
<p>We will use the application SDK — described in detail in the
<a class="reference internal" href="developapps/application.html"><span class="doc">Application</span></a> topic – to invoke a smart contract which
queries and updates the ledger using the smart contract SDK — described in
detail in section <a class="reference internal" href="developapps/smartcontract.html"><span class="doc">Smart Contract Processing</span></a>.</p>
<p>We’ll go through three principle steps:</p>
<blockquote>
<div><p><strong>1. Setting up a development environment.</strong> Our application needs a network
to interact with, so we’ll get a basic network our smart contracts and
application will use.</p>
<img alt="_images/AppConceptsOverview.png" src="_images/AppConceptsOverview.png" />
<p><strong>2. Learning about a sample smart contract, FabCar.</strong>
We use a smart contract written in <strong>JavaScript</strong>. We’ll
inspect the smart contract to learn about the transactions within them, and
how they are used by applications to query and update the ledger.</p>
<p><strong>3. Develop a sample application which uses FabCar.</strong> Our application will
use the FabCar smart contract to query and update car assets on the ledger.
We’ll get into the code of the apps and the transactions they create,
including querying a car, querying a range of cars, and creating a new car.</p>
</div></blockquote>
<p>After completing this tutorial you should have a basic understanding of how an
application is programmed in conjunction with a smart contract to interact with
the ledger hosted and replicated on the peers in a Fabric network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These applications are also compatible with <a class="reference internal" href="discovery-overview.html"><span class="doc">Service Discovery</span></a>
and <a class="reference internal" href="private-data/private-data.html"><span class="doc">Private data</span></a>, though we won’t explicitly show
how to use our apps to leverage those features.</p>
</div>
<div class="section" id="set-up-the-blockchain-network">
<h2>Set up the blockchain network<a class="headerlink" href="#set-up-the-blockchain-network" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This next section requires you to be in the <code class="docutils literal notranslate"><span class="pre">first-network</span></code>
subdirectory within your local clone of the <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repo.</p>
</div>
<p>If you’ve already run through <a class="reference internal" href="build_network.html"><span class="doc">Building Your First Network</span></a>, you will have downloaded
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> and have a network up and running. Before you run this
tutorial, you must stop this network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./byfn.sh down
</pre></div>
</div>
<p>If you have run through this tutorial before, use the following commands to
kill any stale or active containers. Note, this will take down <strong>all</strong> of your
containers whether they’re Fabric related or not.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker rm -f <span class="k">$(</span>docker ps -aq<span class="k">)</span>
docker rmi -f <span class="k">$(</span>docker images <span class="p">|</span> grep fabcar <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>If you don’t have a development environment and the accompanying artifacts for
the network and applications, visit the <a class="reference internal" href="prereqs.html"><span class="doc">Prerequisites</span></a> page and ensure you have
the necessary dependencies installed on your machine.</p>
<p>Next, if you haven’t done so already, visit the <a class="reference internal" href="install.html"><span class="doc">Install Samples, Binaries and Docker Images</span></a> page and follow
the provided instructions. Return to this tutorial once you have cloned the
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repository, and downloaded the latest stable Fabric images
and available utilities.</p>
<p>If you are using Mac OS and running Mojave, you will need to <a class="reference external" href="./tutorial/installxcode.html">install Xcode</a>.</p>
<div class="section" id="launch-the-network">
<h3>Launch the network<a class="headerlink" href="#launch-the-network" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This next section requires you to be in the <code class="docutils literal notranslate"><span class="pre">fabcar</span></code>
subdirectory within your local clone of the <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repo.</p>
</div>
<p>Launch your network using the <code class="docutils literal notranslate"><span class="pre">startFabric.sh</span></code> shell script. This command will
spin up a blockchain network comprising peers, orderers, certificate
authorities and more.  It will also install and instantiate a javascript version
of the <code class="docutils literal notranslate"><span class="pre">FabCar</span></code> smart contract which will be used by our application to access
the ledger. We’ll learn more about these components as we go through the
tutorial.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./startFabric.sh javascript
</pre></div>
</div>
<p>Alright, you’ve now got a sample network up and running, and the <code class="docutils literal notranslate"><span class="pre">FabCar</span></code>
smart contract installed and instantiated. Let’s install our application
pre-requisites so that we can try it out, and see how everything works together.</p>
</div>
<div class="section" id="install-the-application">
<h3>Install the application<a class="headerlink" href="#install-the-application" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following instructions require you to be in the
<code class="docutils literal notranslate"><span class="pre">fabcar/javascript</span></code> subdirectory within your local clone of the
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repo.</p>
</div>
<p>Run the following command to install the Fabric dependencies for the
applications. It will take about a minute to complete:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm install
</pre></div>
</div>
<p>This process is installing the key application dependencies defined in
<code class="docutils literal notranslate"><span class="pre">package.json</span></code>. The most important of which is the <code class="docutils literal notranslate"><span class="pre">fabric-network</span></code> class;
it enables an application to use identities, wallets, and gateways to connect to
channels, submit transactions, and wait for notifications. This tutorial also
uses the <code class="docutils literal notranslate"><span class="pre">fabric-ca-client</span></code> class to enroll users with their respective
certificate authorities, generating a valid identity which is then used by
<code class="docutils literal notranslate"><span class="pre">fabric-network</span></code> class methods.</p>
<p>Once <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> completes, everything is in place to run the application.
For this tutorial, you’ll primarily be using the application JavaScript files in
the <code class="docutils literal notranslate"><span class="pre">fabcar/javascript</span></code> directory. Let’s take a look at what’s inside:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls
</pre></div>
</div>
<p>You should see the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>enrollAdmin.js  node_modules       package.json  registerUser.js
invoke.js       package-lock.json  query.js      wallet
</pre></div>
</div>
<p>There are files for other program languages, for example in the
<code class="docutils literal notranslate"><span class="pre">fabcar/typescript</span></code> directory. You can read these once you’ve used the
JavaScript example – the principles are the same.</p>
<p>If you are using Mac OS and running Mojave, you will need to <a class="reference external" href="./tutorial/installxcode.html">install Xcode</a>.</p>
</div>
</div>
<div class="section" id="enrolling-the-admin-user">
<h2>Enrolling the admin user<a class="headerlink" href="#enrolling-the-admin-user" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following two sections involve communication with the Certificate
Authority. You may find it useful to stream the CA logs when running
the upcoming programs by opening a new terminal shell and running
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">-f</span> <span class="pre">ca.example.com</span></code>.</p>
</div>
<p>When we created the network, an admin user — literally called <code class="docutils literal notranslate"><span class="pre">admin</span></code> —
was created as the <strong>registrar</strong> for the certificate authority (CA). Our first
step is to generate the private key, public key, and X.509 certificate for
<code class="docutils literal notranslate"><span class="pre">admin</span></code> using the <code class="docutils literal notranslate"><span class="pre">enroll.js</span></code> program. This process uses a <strong>Certificate
Signing Request</strong> (CSR) — the private and public key are first generated
locally and the public key is then sent to the CA which returns an encoded
certificate for use by the application. These three credentials are then stored
in the wallet, allowing us to act as an administrator for the CA.</p>
<p>We will subsequently register and enroll a new application user which will be
used by our application to interact with the blockchain.</p>
<p>Let’s enroll user <code class="docutils literal notranslate"><span class="pre">admin</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node enrollAdmin.js
</pre></div>
</div>
<p>This command has stored the CA administrator’s credentials in the <code class="docutils literal notranslate"><span class="pre">wallet</span></code>
directory.</p>
</div>
<div class="section" id="register-and-enroll-user1">
<h2>Register and enroll <code class="docutils literal notranslate"><span class="pre">user1</span></code><a class="headerlink" href="#register-and-enroll-user1" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the administrator’s credentials in a wallet, we can enroll a
new user — <code class="docutils literal notranslate"><span class="pre">user1</span></code> — which will be used to query and update the ledger:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node registerUser.js
</pre></div>
</div>
<p>Similar to the admin enrollment, this program uses a CSR to enroll <code class="docutils literal notranslate"><span class="pre">user1</span></code> and
store its credentials alongside those of <code class="docutils literal notranslate"><span class="pre">admin</span></code> in the wallet. We now have
identities for two separate users — <code class="docutils literal notranslate"><span class="pre">admin</span></code> and <code class="docutils literal notranslate"><span class="pre">user1</span></code> — and these are
used by our application.</p>
<p>Time to interact with the ledger…</p>
</div>
<div class="section" id="querying-the-ledger">
<h2>Querying the ledger<a class="headerlink" href="#querying-the-ledger" title="Permalink to this headline">¶</a></h2>
<p>Each peer in a blockchain network hosts a copy of the ledger, and an application
program can query the ledger by invoking a smart contract which queries the most
recent value of the ledger and returns it to the application.</p>
<p>Here is a simplified representation of how a query works:</p>
<img alt="_images/write_first_app.diagram.1.png" src="_images/write_first_app.diagram.1.png" />
<p>Applications read data from the <a class="reference external" href="./ledger/ledger.html">ledger</a> using a query.
The most common queries involve the current values of data in the ledger – its
<a class="reference external" href="./ledger/ledger.html#world-state">world state</a>. The world state is
represented as a set of key-value pairs, and applications can query data for a
single key or multiple keys. Moreover, the ledger world state can be configured
to use a database like CouchDB which supports complex queries when key-values
are modeled as JSON data. This can be very helpful when looking for all assets
that match certain keywords with particular values; all cars with a particular
owner, for example.</p>
<p>First, let’s run our <code class="docutils literal notranslate"><span class="pre">query.js</span></code> program to return a listing of all the cars on
the ledger. This program uses our second identity – <code class="docutils literal notranslate"><span class="pre">user1</span></code> – to access the
ledger:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node query.js
</pre></div>
</div>
<p>The output should look like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>Wallet path: ...fabric-samples/fabcar/javascript/wallet
Transaction has been evaluated, result is:
[{&quot;Key&quot;:&quot;CAR0&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;blue&quot;,&quot;make&quot;:&quot;Toyota&quot;,&quot;model&quot;:&quot;Prius&quot;,&quot;owner&quot;:&quot;Tomoko&quot;}},
{&quot;Key&quot;:&quot;CAR1&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;red&quot;,&quot;make&quot;:&quot;Ford&quot;,&quot;model&quot;:&quot;Mustang&quot;,&quot;owner&quot;:&quot;Brad&quot;}},
{&quot;Key&quot;:&quot;CAR2&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;green&quot;,&quot;make&quot;:&quot;Hyundai&quot;,&quot;model&quot;:&quot;Tucson&quot;,&quot;owner&quot;:&quot;Jin Soo&quot;}},
{&quot;Key&quot;:&quot;CAR3&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;yellow&quot;,&quot;make&quot;:&quot;Volkswagen&quot;,&quot;model&quot;:&quot;Passat&quot;,&quot;owner&quot;:&quot;Max&quot;}},
{&quot;Key&quot;:&quot;CAR4&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;black&quot;,&quot;make&quot;:&quot;Tesla&quot;,&quot;model&quot;:&quot;S&quot;,&quot;owner&quot;:&quot;Adriana&quot;}},
{&quot;Key&quot;:&quot;CAR5&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;purple&quot;,&quot;make&quot;:&quot;Peugeot&quot;,&quot;model&quot;:&quot;205&quot;,&quot;owner&quot;:&quot;Michel&quot;}},
{&quot;Key&quot;:&quot;CAR6&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;white&quot;,&quot;make&quot;:&quot;Chery&quot;,&quot;model&quot;:&quot;S22L&quot;,&quot;owner&quot;:&quot;Aarav&quot;}},
{&quot;Key&quot;:&quot;CAR7&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;violet&quot;,&quot;make&quot;:&quot;Fiat&quot;,&quot;model&quot;:&quot;Punto&quot;,&quot;owner&quot;:&quot;Pari&quot;}},
{&quot;Key&quot;:&quot;CAR8&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;indigo&quot;,&quot;make&quot;:&quot;Tata&quot;,&quot;model&quot;:&quot;Nano&quot;,&quot;owner&quot;:&quot;Valeria&quot;}},
{&quot;Key&quot;:&quot;CAR9&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;brown&quot;,&quot;make&quot;:&quot;Holden&quot;,&quot;model&quot;:&quot;Barina&quot;,&quot;owner&quot;:&quot;Shotaro&quot;}}]
</pre></div>
</div>
<p>Let’s take a closer look at this program. Use an editor (e.g. atom or visual
studio) and open <code class="docutils literal notranslate"><span class="pre">query.js</span></code>.</p>
<p>The application starts by bringing in scope two key classes from the
<code class="docutils literal notranslate"><span class="pre">fabric-network</span></code> module; <code class="docutils literal notranslate"><span class="pre">FileSystemWallet</span></code> and <code class="docutils literal notranslate"><span class="pre">Gateway</span></code>. These classes
will be used to locate the <code class="docutils literal notranslate"><span class="pre">user1</span></code> identity in the wallet, and use it to
connect to the network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="o">{</span> FileSystemWallet, Gateway <span class="o">}</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;fabric-network&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>The application connects to the network using a gateway:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">gateway</span> <span class="o">=</span> new Gateway<span class="o">()</span><span class="p">;</span>
await gateway.connect<span class="o">(</span>ccp, <span class="o">{</span> wallet, identity: <span class="s1">&#39;user1&#39;</span> <span class="o">})</span><span class="p">;</span>
</pre></div>
</div>
<p>This code creates a new gateway and then uses it to connect the application to
the network. <code class="docutils literal notranslate"><span class="pre">ccp</span></code> describes the network that the gateway will access with the
identity <code class="docutils literal notranslate"><span class="pre">user1</span></code> from <code class="docutils literal notranslate"><span class="pre">wallet</span></code>. See how the <code class="docutils literal notranslate"><span class="pre">ccp</span></code> has been loaded from
<code class="docutils literal notranslate"><span class="pre">../../basic-network/connection.json</span></code> and parsed as a JSON file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">ccpPath</span> <span class="o">=</span> path.resolve<span class="o">(</span>__dirname, <span class="s1">&#39;..&#39;</span>, <span class="s1">&#39;..&#39;</span>, <span class="s1">&#39;basic-network&#39;</span>, <span class="s1">&#39;connection.json&#39;</span><span class="o">)</span><span class="p">;</span>
const <span class="nv">ccpJSON</span> <span class="o">=</span> fs.readFileSync<span class="o">(</span>ccpPath, <span class="s1">&#39;utf8&#39;</span><span class="o">)</span><span class="p">;</span>
const <span class="nv">ccp</span> <span class="o">=</span> JSON.parse<span class="o">(</span>ccpJSON<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>If you’d like to understand more about the structure of a connection profile,
and how it defines the network, check out
<a class="reference external" href="./developapps/connectionprofile.html">the connection profile topic</a>.</p>
<p>A network can be divided into multiple channels, and the next important line of
code connects the application to a particular channel within the network,
<code class="docutils literal notranslate"><span class="pre">mychannel</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">network</span> <span class="o">=</span> await gateway.getNetwork<span class="o">(</span><span class="s1">&#39;mychannel&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>Within this channel, we can access the smart contract <code class="docutils literal notranslate"><span class="pre">fabcar</span></code> to interact
with the ledger:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">contract</span> <span class="o">=</span> network.getContract<span class="o">(</span><span class="s1">&#39;fabcar&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>Within <code class="docutils literal notranslate"><span class="pre">fabcar</span></code> there are many different <strong>transactions</strong>, and our application
initially uses the <code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code> transaction to access the ledger world state
data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">result</span> <span class="o">=</span> await contract.evaluateTransaction<span class="o">(</span><span class="s1">&#39;queryAllCars&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">evaluateTransaction</span></code> method represents one of the simplest interaction
with a smart contract in blockchain network. It simply picks a peer defined in
the connection profile and sends the request to it, where it is evaluated. The
smart contract queries all the cars on the peer’s copy of the ledger and returns
the result to the application. This interaction does not result in an update the
ledger.</p>
</div>
<div class="section" id="the-fabcar-smart-contract">
<h2>The FabCar smart contract<a class="headerlink" href="#the-fabcar-smart-contract" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a look at the transactions within the <code class="docutils literal notranslate"><span class="pre">FabCar</span></code> smart contract.
Navigate to the <code class="docutils literal notranslate"><span class="pre">chaincode/fabcar/javascript/lib</span></code> subdirectory at the root of
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> and open <code class="docutils literal notranslate"><span class="pre">fabcar.js</span></code> in your editor.</p>
<p>See how our smart contract is defined using the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> class:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>class FabCar extends Contract <span class="o">{</span>...
</pre></div>
</div>
<p>Within this class structure, you’ll see that we have the following
transactions defined: <code class="docutils literal notranslate"><span class="pre">initLedger</span></code>, <code class="docutils literal notranslate"><span class="pre">queryCar</span></code>, <code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code>,
<code class="docutils literal notranslate"><span class="pre">createCar</span></code>, and <code class="docutils literal notranslate"><span class="pre">changeCarOwner</span></code>. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>async queryCar<span class="o">(</span>ctx, carNumber<span class="o">)</span> <span class="o">{</span>...<span class="o">}</span>
async queryAllCars<span class="o">(</span>ctx<span class="o">)</span> <span class="o">{</span>...<span class="o">}</span>
</pre></div>
</div>
<p>Let’s take a closer look at the <code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code> transaction to see how it
interacts with the ledger.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>async queryAllCars<span class="o">(</span>ctx<span class="o">)</span> <span class="o">{</span>

  const <span class="nv">startKey</span> <span class="o">=</span> <span class="s1">&#39;CAR0&#39;</span><span class="p">;</span>
  const <span class="nv">endKey</span> <span class="o">=</span> <span class="s1">&#39;CAR999&#39;</span><span class="p">;</span>

  const <span class="nv">iterator</span> <span class="o">=</span> await ctx.stub.getStateByRange<span class="o">(</span>startKey, endKey<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>This code defines the range of cars that <code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code> will retrieve from the
ledger. Every car between <code class="docutils literal notranslate"><span class="pre">CAR0</span></code> and <code class="docutils literal notranslate"><span class="pre">CAR999</span></code> – 1,000 cars in all, assuming
every key has been tagged properly – will be returned by the query. The
remainder of the code iterates through the query results and packages them into
JSON for the application.</p>
<p>Below is a representation of how an application would call different
transactions in a smart contract. Each transaction uses a broad set of APIs such
as <code class="docutils literal notranslate"><span class="pre">getStateByRange</span></code> to interact with the ledger. You can read more about
these APIs in <a class="reference external" href="https://fabric-shim.github.io/master/index.html?redirect=true">detail</a>.</p>
<img alt="_images/RunningtheSample.png" src="_images/RunningtheSample.png" />
<p>We can see our <code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code> transaction, and another called <code class="docutils literal notranslate"><span class="pre">createCar</span></code>.
We will use this later in the tutorial to update the ledger, and add a new block
to the blockchain.</p>
<p>But first, go back to the <code class="docutils literal notranslate"><span class="pre">query</span></code> program and change the
<code class="docutils literal notranslate"><span class="pre">evaluateTransaction</span></code> request to query <code class="docutils literal notranslate"><span class="pre">CAR4</span></code>. The <code class="docutils literal notranslate"><span class="pre">query</span></code> program should
now look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">result</span> <span class="o">=</span> await contract.evaluateTransaction<span class="o">(</span><span class="s1">&#39;queryCar&#39;</span>, <span class="s1">&#39;CAR4&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>Save the program and navigate back to your <code class="docutils literal notranslate"><span class="pre">fabcar/javascript</span></code> directory.
Now run the <code class="docutils literal notranslate"><span class="pre">query</span></code> program again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node query.js
</pre></div>
</div>
<p>You should see the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>Wallet path: ...fabric-samples/fabcar/javascript/wallet
Transaction has been evaluated, result is:
{&quot;colour&quot;:&quot;black&quot;,&quot;make&quot;:&quot;Tesla&quot;,&quot;model&quot;:&quot;S&quot;,&quot;owner&quot;:&quot;Adriana&quot;}
</pre></div>
</div>
<p>If you go back and look at the result from when the transaction was
<code class="docutils literal notranslate"><span class="pre">queryAllCars</span></code>, you can see that <code class="docutils literal notranslate"><span class="pre">CAR4</span></code> was Adriana’s black Tesla model S,
which is the result that was returned here.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">queryCar</span></code> transaction to query against any car, using its
key (e.g. <code class="docutils literal notranslate"><span class="pre">CAR0</span></code>) and get whatever make, model, color, and owner correspond to
that car.</p>
<p>Great. At this point you should be comfortable with the basic query transactions
in the smart contract and the handful of parameters in the query program.</p>
<p>Time to update the ledger…</p>
</div>
<div class="section" id="updating-the-ledger">
<h2>Updating the ledger<a class="headerlink" href="#updating-the-ledger" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve done a few ledger queries and added a bit of code, we’re ready to
update the ledger. There are a lot of potential updates we could make, but
let’s start by creating a <strong>new</strong> car.</p>
<p>From an application perspective, updating the ledger is simple. An application
submits a transaction to the blockchain network, and when it has been
validated and committed, the application receives a notification that
the transaction has been successful. Under the covers this involves the process
of <strong>consensus</strong> whereby the different components of the blockchain network work
together to ensure that every proposed update to the ledger is valid and
performed in an agreed and consistent order.</p>
<img alt="_images/write_first_app.diagram.2.png" src="_images/write_first_app.diagram.2.png" />
<p>Above, you can see the major components that make this process work. As well as
the multiple peers which each host a copy of the ledger, and optionally a copy
of the smart contract, the network also contains an ordering service. The
ordering service coordinates transactions for a network; it creates blocks
containing transactions in a well-defined sequence originating from all the
different applications connected to the network.</p>
<p>Our first update to the ledger will create a new car. We have a separate program
called <code class="docutils literal notranslate"><span class="pre">invoke.js</span></code> that we will use to make updates to the ledger. Just as with
queries, use an editor to open the program and navigate to the code block where
we construct our transaction and submit it to the network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>await contract.submitTransaction<span class="o">(</span><span class="s1">&#39;createCar&#39;</span>, <span class="s1">&#39;CAR12&#39;</span>, <span class="s1">&#39;Honda&#39;</span>, <span class="s1">&#39;Accord&#39;</span>, <span class="s1">&#39;Black&#39;</span>, <span class="s1">&#39;Tom&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>See how the applications calls the smart contract transaction <code class="docutils literal notranslate"><span class="pre">createCar</span></code> to
create a black Honda Accord with an owner named Tom. We use <code class="docutils literal notranslate"><span class="pre">CAR12</span></code> as the
identifying key here, just to show that we don’t need to use sequential keys.</p>
<p>Save it and run the program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node invoke.js
</pre></div>
</div>
<p>If the invoke is successful, you will see output like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Wallet path: ...fabric-samples/fabcar/javascript/wallet
<span class="m">2018</span>-12-11T14:11:40.935Z - info: <span class="o">[</span>TransactionEventHandler<span class="o">]</span>: _strategySuccess: strategy success <span class="k">for</span> transaction <span class="s2">&quot;9076cd4279a71ecf99665aed0ed3590a25bba040fa6b4dd6d010f42bb26ff5d1&quot;</span>
Transaction has been submitted
</pre></div>
</div>
<p>Notice how the <code class="docutils literal notranslate"><span class="pre">invoke</span></code> application interacted with the blockchain network
using the <code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> API, rather than <code class="docutils literal notranslate"><span class="pre">evaluateTransaction</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>await contract.submitTransaction<span class="o">(</span><span class="s1">&#39;createCar&#39;</span>, <span class="s1">&#39;CAR12&#39;</span>, <span class="s1">&#39;Honda&#39;</span>, <span class="s1">&#39;Accord&#39;</span>, <span class="s1">&#39;Black&#39;</span>, <span class="s1">&#39;Tom&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> is much more sophisticated than <code class="docutils literal notranslate"><span class="pre">evaluateTransaction</span></code>.
Rather than interacting with a single peer, the SDK will send the
<code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> proposal to every required organization’s peer in the
blockchain network. Each of these peers will execute the requested smart
contract using this proposal, to generate a transaction response which it signs
and returns to the SDK. The SDK collects all the signed transaction responses
into a single transaction, which it then sends to the orderer. The orderer
collects and sequences transactions from every application into a block of
transactions. It then distributes these blocks to every peer in the network,
where every transaction is validated and committed. Finally, the SDK is
notified, allowing it to return control to the application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> also includes a listener that checks to make
sure the transaction has been validated and committed to the ledger.
Applications should either utilize a commit listener, or
leverage an API like <code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> that does this for you.
Without doing this, your transaction may not have been successfully
orderered, validated, and committed to the ledger.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> does all this for the application! The process by which
the application, smart contract, peers and ordering service work together to
keep the ledger consistent across the network is called consensus, and it is
explained in detail in this <a class="reference external" href="./peers/peers.html">section</a>.</p>
<p>To see that this transaction has been written to the ledger, go back to
<code class="docutils literal notranslate"><span class="pre">query.js</span></code> and change the argument from <code class="docutils literal notranslate"><span class="pre">CAR4</span></code> to <code class="docutils literal notranslate"><span class="pre">CAR12</span></code>.</p>
<p>In other words, change this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">result</span> <span class="o">=</span> await contract.evaluateTransaction<span class="o">(</span><span class="s1">&#39;queryCar&#39;</span>, <span class="s1">&#39;CAR4&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>To this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>const <span class="nv">result</span> <span class="o">=</span> await contract.evaluateTransaction<span class="o">(</span><span class="s1">&#39;queryCar&#39;</span>, <span class="s1">&#39;CAR12&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>Save once again, then query:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node query.js
</pre></div>
</div>
<p>Which should return this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Wallet path: ...fabric-samples/fabcar/javascript/wallet
Transaction has been evaluated, result is:
<span class="o">{</span><span class="s2">&quot;colour&quot;</span>:<span class="s2">&quot;Black&quot;</span>,<span class="s2">&quot;make&quot;</span>:<span class="s2">&quot;Honda&quot;</span>,<span class="s2">&quot;model&quot;</span>:<span class="s2">&quot;Accord&quot;</span>,<span class="s2">&quot;owner&quot;</span>:<span class="s2">&quot;Tom&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>Congratulations. You’ve created a car and verified that its recorded on the
ledger!</p>
<p>So now that we’ve done that, let’s say that Tom is feeling generous and he
wants to give his Honda Accord to someone named Dave.</p>
<p>To do this, go back to <code class="docutils literal notranslate"><span class="pre">invoke.js</span></code> and change the smart contract transaction
from <code class="docutils literal notranslate"><span class="pre">createCar</span></code> to <code class="docutils literal notranslate"><span class="pre">changeCarOwner</span></code> with a corresponding change in input
arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>await contract.submitTransaction<span class="o">(</span><span class="s1">&#39;changeCarOwner&#39;</span>, <span class="s1">&#39;CAR12&#39;</span>, <span class="s1">&#39;Dave&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>The first argument — <code class="docutils literal notranslate"><span class="pre">CAR12</span></code> — identifies the car that will be changing
owners. The second argument — <code class="docutils literal notranslate"><span class="pre">Dave</span></code> — defines the new owner of the car.</p>
<p>Save and execute the program again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node invoke.js
</pre></div>
</div>
<p>Now let’s query the ledger again and ensure that Dave is now associated with the
<code class="docutils literal notranslate"><span class="pre">CAR12</span></code> key:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node query.js
</pre></div>
</div>
<p>It should return this result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Wallet path: ...fabric-samples/fabcar/javascript/wallet
Transaction has been evaluated, result is:
<span class="o">{</span><span class="s2">&quot;colour&quot;</span>:<span class="s2">&quot;Black&quot;</span>,<span class="s2">&quot;make&quot;</span>:<span class="s2">&quot;Honda&quot;</span>,<span class="s2">&quot;model&quot;</span>:<span class="s2">&quot;Accord&quot;</span>,<span class="s2">&quot;owner&quot;</span>:<span class="s2">&quot;Dave&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>The ownership of <code class="docutils literal notranslate"><span class="pre">CAR12</span></code> has been changed from Tom to Dave.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a real world application the smart contract would likely have some
access control logic. For example, only certain authorized users may
create new cars, and only the car owner may transfer the car to
somebody else.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve done a few queries and a few updates, you should have a pretty
good sense of how applications interact with a blockchain network using a smart
contract to query or update the ledger. You’ve seen the basics of the roles
smart contracts, APIs, and the SDK play in queries and updates and you should
have a feel for how different kinds of applications could be used to perform
other business tasks and operations.</p>
</div>
<div class="section" id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<p>As we said in the introduction, we have a whole section on
<a class="reference internal" href="developapps/developing_applications.html"><span class="doc">Developing Applications</span></a> that includes in-depth information on
smart contracts, process and data design, a tutorial using a more in-depth
Commercial Paper <a class="reference external" href="./tutorial/commercial_paper.html">tutorial</a> and a large
amount of other material relating to the development of applications.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial/commercial_paper.html" class="btn btn-neutral float-right" title="Commercial paper tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>