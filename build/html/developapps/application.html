

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Application &mdash; hyperledger-fabricdocs master 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="应用程序设计元素" href="designelements.html" />
    <link rel="prev" title="Smart Contract Processing" href="smartcontract.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">v2.0 Alpha 新功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_applications.html">开发应用程序</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="scenario.html">The scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Process and Data Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="smartcontract.html">Smart Contract Processing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-flow">Basic Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wallet">Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gateway">Gateway</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-channel">Network channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#construct-request">Construct request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submit-transaction">Submit transaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-response">Process response</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="designelements.html">应用程序设计元素</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="developing_applications.html">开发应用程序</a> &raquo;</li>
        
      <li>Application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developapps/application.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="application">
<h1>Application<a class="headerlink" href="#application" title="永久链接至标题">¶</a></h1>
<p>受众:架构师、应用程序和智能合约开发者</p>
<p>An application can interact with a blockchain network by submitting transactions
to a ledger or querying ledger content. This topic covers the mechanics of how
an application does this; in our scenario, organizations access PaperNet using
applications which invoke <strong>issue</strong>, <strong>sell</strong> and <strong>redeem</strong> transactions
defined in a commercial paper smart contract. Even though MagnetoCorp’s
application to issue a commercial paper is basic, it covers all the major points
of understanding.</p>
<p>在这个主题中，我们将涉及:
调用智能合约的应用程序流程
应用程序如何使用钱包和身份
应用程序如何使用网关连接
如何访问特定的网络
如何构造交易请求
如何提交交易
如何处理交易响应</p>
<ul class="simple">
<li><p><a class="reference external" href="#basic-flow">The application flow to invoke a smart contract</a></p></li>
<li><p><a class="reference external" href="#wallet">How an application uses a wallet and identity</a></p></li>
<li><p><a class="reference external" href="#gateway">How an application connects using a gateway</a></p></li>
<li><p><a class="reference external" href="#network-channel">How to access a particular network</a></p></li>
<li><p><a class="reference external" href="#construct-request">How to construct a transaction request</a></p></li>
<li><p><a class="reference external" href="#submit-transaction">How to submit a transaction</a></p></li>
<li><p><a class="reference external" href="#process-response">How to process a transaction response</a></p></li>
</ul>
<p>为了帮助您理解，我们将参考超级账本Fabric提供的商业票据示例应用程序。您可以下载它并在本地运行它。它是用JavaScript编写的，但是逻辑是完全独立于语言的，所以您可以很容易地看到发生了什么!(Java和GOLANG也将提供该示例。)</p>
<div class="section" id="basic-flow">
<h2>Basic Flow<a class="headerlink" href="#basic-flow" title="永久链接至标题">¶</a></h2>
<p>应用程序使用Fabric SDK与区块链网络进行交互。下面是一个应用程序如何调用商业票据智能合约的简化图:</p>
<p><img alt="../_images/develop.diagram.3.png" src="../_images/develop.diagram.3.png" />develop.application <em>A PaperNet application invokes
the commercial paper smart contract to submit an issue transaction request.</em></p>
<p>申请提交交易须遵循六个基本步骤:</p>
<ul class="simple">
<li><p>Select an identity from a wallet</p></li>
<li><p>Connect to a gateway</p></li>
<li><p>Access the desired network</p></li>
<li><p>Construct a transaction request for a smart contract</p></li>
<li><p>Submit the transaction to the network</p></li>
<li><p>Process the response</p></li>
</ul>
<p>您将看到一个典型的应用程序如何使用Fabric SDK执行这六个步骤。您将在issue.js文件中找到应用程序代码。在您的浏览器中查看它，或者在您最喜欢的编辑器中打开它(如果您已经下载了它)。花点时间看看应用程序的整体结构;即使有注释和间距，也只有100行代码!</p>
</div>
<div class="section" id="wallet">
<h2>Wallet<a class="headerlink" href="#wallet" title="永久链接至标题">¶</a></h2>
<p>在issue.js的顶部，你会看到两个Fabric类被纳入作用域:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">FileSystemWallet</span><span class="p">,</span> <span class="nx">Gateway</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fabric-network&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>您可以阅读node SDK文档中关于fabric-network类的内容，但是现在，让我们看看如何将MagnetoCorp的应用程序连接到PaperNet。应用程序使用Fabric Wallet（钱包）类如下:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileSystemWallet</span><span class="p">(</span><span class="s1">&#39;../identity/user/isabella/wallet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>查看wallet如何在本地文件系统中定位钱包。从钱包中检索到的身份显然是针对一个名为Isabella的用户的，他正在使用发行应用程序。该钱包拥有一组身份(X.509数字证书)，可用于访问PaperNet或任何其他Fabric网络。如果您运行本教程并查看这个目录，您将看到Isabella的身份凭证。</p>
<p>想象一个钱包，里面装着你的身份证、驾照或ATM卡的数字等价物。其中的X.509数字证书将使持有者与某个组织相关联，从而赋予他们在网络通道中的权利。例如，Isabella可能是MagnetoCorp的一名管理员，这可能会给她比其他用户(来自DigiBank的Balaji)更多的特权。此外，智能合约可以在使用交易上下文进行智能合约处理期间检索此身份。</p>
<p>还要注意，钱包里没有任何形式的现金或代币——它们容纳身份。</p>
</div>
<div class="section" id="gateway">
<h2>Gateway<a class="headerlink" href="#gateway" title="永久链接至标题">¶</a></h2>
<p>第二个关键类是Fabric网关。最重要的是，网关标识一个或多个peer，这些peer提供对网络的访问——在我们的示例中是PaperNet。查看issue.js如何连接到它的网关:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">connectionProfile</span><span class="p">,</span> <span class="nx">connectionOptions</span><span class="p">);</span>
</pre></div>
</div>
<p>gateway.connect()有两个重要的参数:
- connectionProfile:连接概要文件的文件系统位置，它将一组peer标识为到PaperNet的网关
- connectionOptions:一组用于控制issue.js如何与PaperNet交互的选项</p>
<ul class="simple">
<li><p><strong>connectionProfile</strong>: the file system location of a
<a class="reference external" href="./connectionprofile.html">connection profile</a> that identifies
a set of peers as a gateway to PaperNet</p></li>
<li><p><strong>connectionOptions</strong>: a set of options used to control how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>
interacts with PaperNet</p></li>
</ul>
<p>了解客户端应用程序如何使用网关将自己与可能发生更改的网络拓扑隔离。网关使用连接概要文件和连接选项将交易提议发送到网络中的正确peer节点。</p>
<p>花一些时间检查连接概要文件 ./gateway/connectionProfile.yaml。它使用YAML，使其易于阅读。</p>
<p>加载并转换为JSON对象:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionProfile</span> <span class="o">=</span> <span class="nx">yaml</span><span class="p">.</span><span class="nx">safeLoad</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;./gateway/connectionProfile.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>现在，我们只对概要文件的 channels: 和peers: 部分感兴趣(我们稍微修改了一些细节，以便更好地解释发生了什么)。</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">channels</span><span class="p">:</span>
  <span class="nt">papernet</span><span class="p">:</span>
    <span class="nt">peers</span><span class="p">:</span>
      <span class="nt">peer1.magnetocorp.com</span><span class="p">:</span>
        <span class="nt">endorsingPeer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">eventSource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

      <span class="nt">peer2.digibank.com</span><span class="p">:</span>
        <span class="nt">endorsingPeer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">eventSource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">peers</span><span class="p">:</span>
  <span class="nt">peer1.magnetocorp.com</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpcs://localhost:7051</span>
    <span class="nt">grpcOptions</span><span class="p">:</span>
      <span class="nt">ssl-target-name-override</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peer1.magnetocorp.com</span>
      <span class="nt">request-timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
    <span class="nt">tlsCACerts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificates/magnetocorp/magnetocorp.com-cert.pem</span>

  <span class="nt">peer2.digibank.com</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpcs://localhost:8051</span>
    <span class="nt">grpcOptions</span><span class="p">:</span>
      <span class="nt">ssl-target-name-override</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peer1.digibank.com</span>
    <span class="nt">tlsCACerts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificates/digibank/digibank.com-cert.pem</span>
</pre></div>
</div>
<p>请参见channel: 如何标识PaperNet: 网络通道，及其两个peer。MagnetoCorp拥有peer1.magenetocorp.com和DigiBank拥有peer2.digibank.com，两者都具有着背书peer的角色。通过peers: key 连接到这些peer，其中包含关于如何连接到它们的详细信息，包括它们各自的网络地址。</p>
<p>连接配置文件包含很多信息——不仅仅是peer——还包括网络通道、网络排序器、组织和CA，所以如果您不了解所有信息，请不要担心!</p>
<p>现在让我们将注意力转向connectionOptions对象:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">identity</span><span class="o">:</span> <span class="nx">userName</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="o">:</span> <span class="nx">wallet</span>
<span class="p">}</span>
</pre></div>
</div>
<p>查看它如何指定用于连接到网关的标识、用户名和钱包。这些值是在代码的前部赋予的。</p>
<p>应用程序还可以使用其他连接选项来指示SDK代表它聪明地工作。例如:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">identity</span><span class="o">:</span> <span class="nx">userName</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="o">:</span> <span class="nx">wallet</span><span class="p">,</span>
  <span class="nx">eventHandlerOptions</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">commitTimeout</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="nx">strategy</span><span class="o">:</span> <span class="nx">EventStrategies</span><span class="p">.</span><span class="nx">MSPID_SCOPE_ANYFORTX</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这里，commitTimeout告诉SDK等待100秒，以得知交易是否被提交。 strategy: EventStrategies.MSPID_SCOPE_ANYFORTX指定SDK可以在一个MagnetoCorp peer确认了交易之后通知应用程序，这与strategy: EventStrategies.NETWORK_SCOPE_ALLFORTX形成了对比，它要求来自MagnetoCorp和DigiBank的所有peer确认这笔交易。</p>
<p>如果您愿意，请阅读更多关于连接选项如何允许应用程序指定面向目标的行为，而不必担心如何实现该行为。</p>
</div>
<div class="section" id="network-channel">
<h2>Network channel<a class="headerlink" href="#network-channel" title="永久链接至标题">¶</a></h2>
<p>在网关的connectionProfile.yaml 中定义的peer提供了issue.js访问PaperNet的权限。因为这些peer可以连接到多个网络通道，所以网关实际上为应用程序提供了对多个网络通道的访问!</p>
<p>查看应用程序如何选择一个特定的通道:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">network</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">getNetwork</span><span class="p">(</span><span class="s1">&#39;PaperNet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>从这一点开始，网络将提供访问PaperNet。此外，如果应用程序想同时访问另一个网络BondNet，则很容易:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">network2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">getNetwork</span><span class="p">(</span><span class="s1">&#39;BondNet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>现在我们的应用程序可以访问第二个网络BondNet，与PaperNet一起!</p>
<p>我们可以在这里看到超级账本Fabric的一个强大特性——应用程序可以通过连接到多个网关peer(每个网关peer都加入到多个网络通道)，参与到一个网络网络中。根据gateway.connect()中提供的钱包身份，应用程序在不同的通道中具有不同的权限。</p>
</div>
<div class="section" id="construct-request">
<h2>Construct request<a class="headerlink" href="#construct-request" title="永久链接至标题">¶</a></h2>
<p>该应用程序现在可以发行商业票据了。要做到这一点，它将使用CommercialPaperContract，同样，它是简单地访问这个智能合约:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">network</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;papercontract&#39;</span><span class="p">,</span> <span class="s1">&#39;org.papernet.commercialpaper&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>注意，应用程序如何提供一个名称——papercontract——和一个显式的合约名称:org.papernet.commercialpaper! 我们将看到如何利用合约名称从包含许多合约的papercontract.js链码文件中选择一个合约。在PaperNet中，papercontract.js以papercontract的名称安装和实例化，如果您感兴趣，请阅读如何安装和实例化包含多个智能合约的链码。</p>
<p>如果我们的应用程序需要同时在PaperNet或BondNet访问另一个合约这将是容易的:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">euroContract</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">network</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;EuroCommercialPaperContract&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">bondContract</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">network2</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;BondContract&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>在这些示例中，请注意我们没有使用符合条件的合约名称——每个文件只有一个智能合约，getContract()将使用它找到的第一个合约。</p>
<p>回忆一下MagnetoCorp发行第一份商业票据时的交易:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Txn</span> <span class="o">=</span> <span class="n">issue</span>
<span class="n">Issuer</span> <span class="o">=</span> <span class="n">MagnetoCorp</span>
<span class="n">Paper</span> <span class="o">=</span> <span class="mi">00001</span>
<span class="n">Issue</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">31</span> <span class="n">May</span> <span class="mi">2020</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">EST</span>
<span class="n">Maturity</span> <span class="n">date</span> <span class="o">=</span> <span class="mi">30</span> <span class="n">November</span> <span class="mi">2020</span>
<span class="n">Face</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="n">M</span> <span class="n">USD</span>
</pre></div>
</div>
<p>现在让我们把这个交易提交到PaperNet!</p>
</div>
<div class="section" id="submit-transaction">
<h2>Submit transaction<a class="headerlink" href="#submit-transaction" title="永久链接至标题">¶</a></h2>
<p>提交交易是对SDK的一个方法调用:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">issueResponse</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">submitTransaction</span><span class="p">(</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;MagnetoCorp&#39;</span><span class="p">,</span> <span class="s1">&#39;00001&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;5000000&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>查看submitTransaction()参数如何匹配交易请求的参数。这些值将传递给智能合约中的issue()方法，并用于创建新的商业票据。回忆它的签名:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">async</span> <span class="nx">issue</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">issuer</span><span class="p">,</span> <span class="nx">paperNumber</span><span class="p">,</span> <span class="nx">issueDateTime</span><span class="p">,</span> <span class="nx">maturityDateTime</span><span class="p">,</span> <span class="nx">faceValue</span><span class="p">)</span> <span class="p">{...}</span>
</pre></div>
</div>
<p>智能合约似乎在应用程序发出submitTransaction()之后不久就会收到控制，但事实并非如此。在幕后，SDK使用connectionOptions和connectionProfile详细信息将交易提议发送到网络中的正确peer，在那里可以获得所需的背书。但是应用程序不需要担心这些——它只会发出submitTransaction, SDK会处理所有这些!</p>
<p>注意，submitTransaction API包含一个侦听交易提交的进程。侦听提交是必需的，因为没有提交，您将不知道您的交易是否已成功地排序、验证和提交到账本。</p>
<p>现在让我们将注意力转向应用程序如何处理响应!</p>
</div>
<div class="section" id="process-response">
<h2>Process response<a class="headerlink" href="#process-response" title="永久链接至标题">¶</a></h2>
<p>回想一下papercontract.js中的发行交易如何返回商业票据响应:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">toBuffer</span><span class="p">();</span>
</pre></div>
</div>
<p>您将注意到一个小问题——在将新文件返回到应用程序之前，需要将其转换为缓冲。注意issue.js如何使用CommercialPaper.fromBuffer()类方法将响应缓冲重新还原为商业票据:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">paper</span> <span class="o">=</span> <span class="nx">CommercialPaper</span><span class="p">.</span><span class="nx">fromBuffer</span><span class="p">(</span><span class="nx">issueResponse</span><span class="p">);</span>
</pre></div>
</div>
<p>这使得票据能够以一种自然的方式在一个描述性的完成信息中使用:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">issuer</span><span class="si">}</span><span class="sb"> commercial paper : </span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">paperNumber</span><span class="si">}</span><span class="sb"> successfully issued for value </span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">faceValue</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</pre></div>
</div>
<p>查看相同的票据类在应用程序和智能合约中是如何使用的——如果您像这样构造代码，它将真正有助于可读性和重用。</p>
<p>与交易提议一样，应用程序可能会在智能合约完成后不久收到控制，但事实并非如此。在幕后，SDK管理整个共识过程，并根据策略connectionOption通知应用程序何时完成。如果您对SDK的底层功能感兴趣，请阅读详细的交易流程。</p>
<p>就是这样! 在本主题中，通过研究MagnetoCorp的应用程序如何在PaperNet中发行新的商业票据，您已经了解了如何从示例应用程序调用智能合约。现在研究一下关键账本和智能合约数据结构背后的架构主题。</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="designelements.html" class="btn btn-neutral float-right" title="应用程序设计元素" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="smartcontract.html" class="btn btn-neutral" title="Smart Contract Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>