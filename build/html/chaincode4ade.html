

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>链码开发者 &mdash; hyperledger-fabricdocs master 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Chaincode for Operators" href="chaincode4noah.html" />
    <link rel="prev" title="链码教程" href="chaincode.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">v2.0 Alpha 新功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="developapps/developing_applications.html">开发应用程序</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/commercial_paper.html">Commercial paper tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_network.html">搭建你的第一个网络（BYFN）</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel_update_tutorial.html">向通道添加组织</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="private_data_tutorial.html">在Fabric里面使用私有数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode.html">链码教程</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">链码开发者</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-chaincode">什么是链码？</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chaincode-api">链码API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-asset-chaincode">简单资产链码</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#choosing-a-location-for-the-code">为代码选择一个位置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#housekeeping">辅助工作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initializing-the-chaincode">初始化链码</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invoking-the-chaincode">调用链码</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementing-the-chaincode-application">实现链码应用程序</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pulling-it-all-together">放在一起</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-chaincode">构建链码</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-using-dev-mode">用开发模式测试</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#install-hyperledger-fabric-samples">安装超级账本Fabric示例</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminal-1-start-the-network">终端1 - 启动网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminal-2-build-start-the-chaincode">终端2 - 构建和启动链码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminal-3-use-the-chaincode">终端3 - 使用链码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-new-chaincode">测试新链码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chaincode-access-control">链码访问控制</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chaincode-encryption">链码加密</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-external-dependencies-for-chaincode-written-in-go">管理用Go编写的链码的外部依赖关系</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="videos.html">视频</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>链码开发者</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/chaincode4ade.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chaincode-for-developers">
<h1>链码开发者<a class="headerlink" href="#chaincode-for-developers" title="永久链接至标题">¶</a></h1>
<div class="section" id="what-is-chaincode">
<h2>什么是链码？<a class="headerlink" href="#what-is-chaincode" title="永久链接至标题">¶</a></h2>
<p>Chaincode是一个程序，用`Go &lt;<a class="reference external" href="https://golang.org">https://golang.org</a>&gt;`_, <a class="reference external" href="https://nodejs.org">node.js</a>, or <a href="#id1"><span class="problematic" id="id2">`</span></a>Java &lt;<a class="reference external" href="https://java.com/en/">https://java.com/en/</a>&gt;`_编写，实现指定的接口。链码运行在安全的Docker容器中，该容器与背书节点进程隔离。链码通过应用提交的交易初始化和管理账本状态。</p>
<p>链码通常处理网络成员同意的业务逻辑，因此它类似于“智能合约”。在一个提议交易中，可以调用链码来更新或查询账本。给予适当的权限，一个链码可以调用另一个链码(在相同通道中或在不同通道中)来访问其状态。注意，如果被调用的链码位于与调用链码不同的通道上，则只允许读查询。也就是说，在不同通道上被调用的链码只是一个“查询”，它不参与后续提交阶段的状态验证检查。</p>
<p>在下面的部分中，我们将通过应用开发者的视角来研究链码。我们将展示一个简单的链码示例应用程序，并介绍Chaincode Shim API中每个方法的用途。</p>
</div>
<div class="section" id="chaincode-api">
<h2>链码API<a class="headerlink" href="#chaincode-api" title="永久链接至标题">¶</a></h2>
<p>每个链码程序都必须实现``Chaincode`` 接口，该接口的方法是在收到交易的响应中被调用的。你可以在下面找到适用于不同语言的Chaincode Shim API的参考文档:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#Chaincode">Go</a></p></li>
<li><p><a class="reference external" href="https://fabric-shim.github.io/ChaincodeInterface.html">node.js</a></p></li>
<li><p><a class="reference external" href="https://fabric-chaincode-java.github.io/org/hyperledger/fabric/shim/Chaincode.html">Java</a></p></li>
</ul>
</div></blockquote>
<p>在每种语言中，客户端调用``Invoke`` 方法来提交交易提议。此方法允许您使用链码读取和写入通道账本上的数据。</p>
<p>您还需要包含一个 <code class="docutils literal notranslate"><span class="pre">Init</span></code> 方法，它将作为链码的初始化函数。当链码启动或升级时，将调用此方法来初始化链码。默认情况下，这个函数永远不会执行。但是，您可以使用链码定义来请求执行 <code class="docutils literal notranslate"><span class="pre">Init</span></code> 函数。如果请求执行 <code class="docutils literal notranslate"><span class="pre">Init</span></code> ，Fabric将确保在调用任何其他函数之前调用 <code class="docutils literal notranslate"><span class="pre">Init</span></code> ，并且只调用一次。该选项为您提供了额外的控制，用户可以对其中的链码进行初始化，并能够将初始数据添加到账本。如果您正在使用节点的CLI来批准链码定义，请使用``–init-required`` 标志来请求执行``Init`` 函数。然后使用 <cite>peer chaincode invoke`命令调用``Init`</cite> 函数，并传入 <code class="docutils literal notranslate"><span class="pre">--isInit</span></code> 标志。如果您正在为Node.js使用Fabric SDK，请访问 <a href="#id5"><span class="problematic" id="id6">`如何安装和启动您的链码&lt;https://fabric-sdk-node.github.io/master/tutorial-chaincode-lifecycle.html&gt;`__</span></a>。更多信息，请看 <a class="reference internal" href="chaincode4noah.html"><span class="doc">Chaincode for Operators</span></a>。</p>
<p>在链码“shim”API中的另一个接口是“ChaincodeStubInterface”:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStubInterface">Go</a></p></li>
<li><p><a class="reference external" href="https://fabric-shim.github.io/ChaincodeStub.html">node.js</a></p></li>
<li><p><a class="reference external" href="https://fabric-chaincode-java.github.io/org/hyperledger/fabric/shim/ChaincodeStub.html">Java</a></p></li>
</ul>
</div></blockquote>
<p>这些用于存取和修改账本，并在链码之间进行调用。</p>
<p>在使用Go链码的本教程中，我们将通过实现一个管理简单“资产”的简单链码应用程序来演示这些API的使用。</p>
</div>
<div class="section" id="simple-asset-chaincode">
<span id="id3"></span><h2>简单资产链码<a class="headerlink" href="#simple-asset-chaincode" title="永久链接至标题">¶</a></h2>
<p>我们的应用程序是一个基本的链码示例，用于在账本上创建资产(键值对)。</p>
<div class="section" id="choosing-a-location-for-the-code">
<h3>为代码选择一个位置<a class="headerlink" href="#choosing-a-location-for-the-code" title="永久链接至标题">¶</a></h3>
<p>如果您没有用过Go编程，您可能希望确保已经安装了 <a class="reference internal" href="prereqs.html#golang"><span class="std std-ref">Go Programming Language</span></a> 并正确配置了系统。</p>
<p>现在，您需要为链码应用程序创建一个目录，作为``$GOPATH/src/<a href="#id1"><span class="problematic" id="id2">``</span></a>的子目录。</p>
<p>为了简单起见，我们使用以下命令:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p <span class="nv">$GOPATH</span>/src/sacc <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/sacc
</pre></div>
</div>
<p>现在，让我们创建源文件，我们将用下列代码填充:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch sacc.go
</pre></div>
</div>
</div>
<div class="section" id="housekeeping">
<h3>辅助工作<a class="headerlink" href="#housekeeping" title="永久链接至标题">¶</a></h3>
<p>首先，让我们从一些辅助工作开始。与每个链码一样，它实现了 <a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#Chaincode">Chaincode interface</a>  特别是 <code class="docutils literal notranslate"><span class="pre">Init</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Invoke</span></code> 函数。因此，让我们添加Go import语句，用于链码的必要依赖项。我们将导入链码shim包和`peer protobuf package &lt;<a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/protos/peer">https://godoc.org/github.com/hyperledger/fabric/protos/peer</a>&gt;`_。接下来，让我们添加一个结构 <code class="docutils literal notranslate"><span class="pre">SimpleAsset</span></code> 作为Chaincode shim函数的接收器。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>

    <span class="s">&quot;github.com/hyperledger/fabric/core/chaincode/shim&quot;</span>
    <span class="s">&quot;github.com/hyperledger/fabric/protos/peer&quot;</span>
<span class="p">)</span>

<span class="c1">// SimpleAsset implements a simple chaincode to manage an asset</span>
<span class="kd">type</span> <span class="nx">SimpleAsset</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="initializing-the-chaincode">
<h3>初始化链码<a class="headerlink" href="#initializing-the-chaincode" title="永久链接至标题">¶</a></h3>
<p>下面，我们将实现``Init`` 函数。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Init is called during chaincode instantiation to initialize any data.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>注意，链码升级也调用这个函数。在编写现有链码升级的链码时，请确保适当地修改``Init`` 函数。特别是，如果没有“迁移”或升级过程中没有需要初始化的内容，请提供一个空的“Init”方法。</p>
</div>
<p>接下来，我们将使用函数 <a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.GetStringArgs">ChaincodeStubInterface.GetStringArgs</a> 检索参数调用``Init``，并检查有效性。在我们的示例中，我们期望取到一个键值对。</p>
<blockquote>
<div><div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Init is called during chaincode instantiation to initialize any</span>
<span class="c1">// data. Note that chaincode upgrade also calls this function to reset</span>
<span class="c1">// or to migrate data, so be careful to avoid a scenario where you</span>
<span class="c1">// inadvertently clobber your ledger&#39;s data!</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
  <span class="c1">// Get the args from the transaction proposal</span>
  <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetStringArgs</span><span class="p">()</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key and a value&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>接下来，既然我们已经确定调用是有效的，我们将在账本中存储初始状态。为此，我们将以键和值作为参数传入调用`ChaincodeStubInterface.PutState &lt;<a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.PutState">https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.PutState</a>&gt;`_ 。PutState ‘ _。假设一切顺利，返回一个表明初始化成功的peer.Response对象。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Init is called during chaincode instantiation to initialize any</span>
<span class="c1">// data. Note that chaincode upgrade also calls this function to reset</span>
<span class="c1">// or to migrate data, so be careful to avoid a scenario where you</span>
<span class="c1">// inadvertently clobber your ledger&#39;s data!</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
  <span class="c1">// Get the args from the transaction proposal</span>
  <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetStringArgs</span><span class="p">()</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key and a value&quot;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// Set up any variables or assets here by calling stub.PutState()</span>

  <span class="c1">// We store the key and the value on the ledger</span>
  <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">PutState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Failed to create asset: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Success</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="invoking-the-chaincode">
<h3>调用链码<a class="headerlink" href="#invoking-the-chaincode" title="永久链接至标题">¶</a></h3>
<p>首先，让我们添加``Invoke`` 函数的签名。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Invoke is called per transaction on the chaincode. Each transaction is</span>
<span class="c1">// either a &#39;get&#39; or a &#39;set&#39; on the asset created by Init function. The &#39;set&#39;</span>
<span class="c1">// method may create a new asset by specifying a new key-value pair.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<p>与上面的``Init`` 函数一样，我们需要从``ChaincodeStubInterface``中提取参数。函数的参数将是要调用的链码应用的函数名称。在我们的例子中，应用只有两个函数：<code class="docutils literal notranslate"><span class="pre">set``和``get</span></code>，它们允许设置资产的值或检索资产的当前状态。我们首先调用`ChaincodeStubInterface.GetFunctionAndParameters &lt;<a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.GetFunctionAndParameters">https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.GetFunctionAndParameters</a>&gt;`_提取函数名和链码应用函数的参数。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Invoke is called per transaction on the chaincode. Each transaction is</span>
<span class="c1">// either a &#39;get&#39; or a &#39;set&#39; on the asset created by Init function. The Set</span>
<span class="c1">// method may create a new asset by specifying a new key-value pair.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
    <span class="c1">// Extract the function and args from the transaction proposal</span>
    <span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetFunctionAndParameters</span><span class="p">()</span>

<span class="p">}</span>
</pre></div>
</div>
<p>接下来，我们将验证函数名是否为``set`` 或 <code class="docutils literal notranslate"><span class="pre">get</span></code>，并调用那些链码应用程序函数，通过``shim.Success``或``shim.Error``函数返回适当的响应，该函数将响应序列化为gRPC protobuf消息。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Invoke is called per transaction on the chaincode. Each transaction is</span>
<span class="c1">// either a &#39;get&#39; or a &#39;set&#39; on the asset created by Init function. The Set</span>
<span class="c1">// method may create a new asset by specifying a new key-value pair.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
    <span class="c1">// Extract the function and args from the transaction proposal</span>
    <span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetFunctionAndParameters</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="kt">string</span>
    <span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
    <span class="k">if</span> <span class="nx">fn</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="p">{</span>
            <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">set</span><span class="p">(</span><span class="nx">stub</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">get</span><span class="p">(</span><span class="nx">stub</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="c1">// Return the result as success payload</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Success</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-the-chaincode-application">
<h3>实现链码应用程序<a class="headerlink" href="#implementing-the-chaincode-application" title="永久链接至标题">¶</a></h3>
<p>如前所述，我们的链码应用程序实现了两个可以通过``Invoke`` ‘函数调用的函数。现在我们来实现这些函数。请注意，如前所述，要访问账本的状态，我们将利用链码shim API的 <a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.PutState">ChaincodeStubInterface.PutState</a> 和 <a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.GetState">ChaincodeStubInterface.GetState</a> 函数。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Set stores the asset (both key and value) on the ledger. If the key exists,</span>
<span class="c1">// it will override the value with the new one</span>
<span class="kd">func</span> <span class="nx">set</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key and a value&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">PutState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Failed to set asset: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Get returns the value of the specified asset key</span>
<span class="kd">func</span> <span class="nx">get</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">value</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Failed to get asset: %s with error: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">value</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Asset not found: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pulling-it-all-together">
<span id="chaincode-sample"></span><h3>放在一起<a class="headerlink" href="#pulling-it-all-together" title="永久链接至标题">¶</a></h3>
<p>最后，我们需要添加``main`` 函数，它将调用`shim.Start &lt;<a class="reference external" href="https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#Start">https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#Start</a>&gt;`_ 函数。这是完整的链码程序源代码。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>

    <span class="s">&quot;github.com/hyperledger/fabric/core/chaincode/shim&quot;</span>
    <span class="s">&quot;github.com/hyperledger/fabric/protos/peer&quot;</span>
<span class="p">)</span>

<span class="c1">// SimpleAsset implements a simple chaincode to manage an asset</span>
<span class="kd">type</span> <span class="nx">SimpleAsset</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Init is called during chaincode instantiation to initialize any</span>
<span class="c1">// data. Note that chaincode upgrade also calls this function to reset</span>
<span class="c1">// or to migrate data.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
    <span class="c1">// Get the args from the transaction proposal</span>
    <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetStringArgs</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key and a value&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Set up any variables or assets here by calling stub.PutState()</span>

    <span class="c1">// We store the key and the value on the ledger</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">PutState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Failed to create asset: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Success</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Invoke is called per transaction on the chaincode. Each transaction is</span>
<span class="c1">// either a &#39;get&#39; or a &#39;set&#39; on the asset created by Init function. The Set</span>
<span class="c1">// method may create a new asset by specifying a new key-value pair.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">SimpleAsset</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
    <span class="c1">// Extract the function and args from the transaction proposal</span>
    <span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetFunctionAndParameters</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="kt">string</span>
    <span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
    <span class="k">if</span> <span class="nx">fn</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="p">{</span>
            <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">set</span><span class="p">(</span><span class="nx">stub</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// assume &#39;get&#39; even if fn is nil</span>
            <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">get</span><span class="p">(</span><span class="nx">stub</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="c1">// Return the result as success payload</span>
    <span class="k">return</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Success</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// Set stores the asset (both key and value) on the ledger. If the key exists,</span>
<span class="c1">// it will override the value with the new one</span>
<span class="kd">func</span> <span class="nx">set</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key and a value&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">PutState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Failed to set asset: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Get returns the value of the specified asset key</span>
<span class="kd">func</span> <span class="nx">get</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Incorrect arguments. Expecting a key&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">value</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">GetState</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Failed to get asset: %s with error: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">value</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Asset not found: %s&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// main function starts up the chaincode in the container during instantiate</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">Start</span><span class="p">(</span><span class="nb">new</span><span class="p">(</span><span class="nx">SimpleAsset</span><span class="p">));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error starting SimpleAsset chaincode: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="building-chaincode">
<h3>构建链码<a class="headerlink" href="#building-chaincode" title="永久链接至标题">¶</a></h3>
<p>现在让我们编译你的链码</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>go get -u github.com/hyperledger/fabric/core/chaincode/shim
go build
</pre></div>
</div>
<p>假设没有错误，现在我们可以继续下一步，测试您的链码。</p>
</div>
<div class="section" id="testing-using-dev-mode">
<h3>用开发模式测试<a class="headerlink" href="#testing-using-dev-mode" title="永久链接至标题">¶</a></h3>
<p>通常，链码由节点启动和维护。但是在“开发模式”中，链码是由用户构建和启动的。这种模式在链码开发阶段对于快速代码/构建/运行/调试循环非常有用。</p>
<p>我们利用预生成的排序器和通道构件组成的示例开发网络来启动“开发模式”。因此，用户可以立即跳到编译链码和驱动调用的过程中。</p>
</div>
</div>
<div class="section" id="install-hyperledger-fabric-samples">
<h2>安装超级账本Fabric示例<a class="headerlink" href="#install-hyperledger-fabric-samples" title="永久链接至标题">¶</a></h2>
<p>如果您还没有这样做，请 <a class="reference internal" href="install.html"><span class="doc">Install Samples, Binaries and Docker Images</span></a>。</p>
<p>导航到“fabric-samples”克隆体的“chaincode-docker-devmode”目录:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> chaincode-docker-devmode
</pre></div>
</div>
<p>现在打开三个终端并导航到每个终端的“chaincode-docker-devmode”目录。</p>
</div>
<div class="section" id="terminal-1-start-the-network">
<h2>终端1 - 启动网络<a class="headerlink" href="#terminal-1-start-the-network" title="永久链接至标题">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose-simple.yaml up
</pre></div>
</div>
<p>上面的代码使用“SingleSampleMSPSolo”排序器配置文件启动网络，并在“dev模式”中启动节点。它还启动了另外两个容器，一个用于链码环境，另一个用于CLI与链码交互。创建和加入通道的命令嵌入到CLI容器中，因此我们可以立即跳转到链码调用。</p>
</div>
<div class="section" id="terminal-2-build-start-the-chaincode">
<h2>终端2 - 构建和启动链码<a class="headerlink" href="#terminal-2-build-start-the-chaincode" title="永久链接至标题">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it chaincode bash
</pre></div>
</div>
<p>你将看到如下结果：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@d2629980e76b:/opt/gopath/src/chaincode#
</pre></div>
</div>
<p>现在，编译你的链码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> sacc
go build
</pre></div>
</div>
<p>现在运行链码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CORE_PEER_ADDRESS</span><span class="o">=</span>peer:7052 <span class="nv">CORE_CHAINCODE_ID_NAME</span><span class="o">=</span>mycc:0 ./sacc
</pre></div>
</div>
<p>链码由节点启动，链码日志表明节点注册成功。注意，在这个阶段，链码与任何通道都没有关联。这是在后续步骤中使用 <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> 命令完成的。</p>
</div>
<div class="section" id="terminal-3-use-the-chaincode">
<h2>终端3 - 使用链码<a class="headerlink" href="#terminal-3-use-the-chaincode" title="永久链接至标题">¶</a></h2>
<p>即使您处于 <code class="docutils literal notranslate"><span class="pre">--peer-chaincodedev</span></code> 模式，您仍然必须安装链码，以便生命周期系统链码能够正常通过检查。这个要求可能会在以后的 <code class="docutils literal notranslate"><span class="pre">--peer-chaincodedev</span></code> 模式中被删除。</p>
<p>我们将利用CLI容器来驱动这些调用。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it cli bash
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>peer chaincode install -p chaincodedev/chaincode/sacc -n mycc -v <span class="m">0</span>
peer chaincode instantiate -n mycc -v <span class="m">0</span> -c <span class="s1">&#39;{&quot;Args&quot;:[&quot;a&quot;,&quot;10&quot;]}&#39;</span> -C myc
</pre></div>
</div>
<p>现在发出一个调用，将“a”的值更改为“20”。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>peer chaincode invoke -n mycc -c <span class="s1">&#39;{&quot;Args&quot;:[&quot;set&quot;, &quot;a&quot;, &quot;20&quot;]}&#39;</span> -C myc
</pre></div>
</div>
<p>最后,查询 <code class="docutils literal notranslate"><span class="pre">a</span></code>。我们应该看到’<a href="#id1"><span class="problematic" id="id2">``</span></a>20``的值。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>peer chaincode query -n mycc -c <span class="s1">&#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]}&#39;</span> -C myc
</pre></div>
</div>
</div>
<div class="section" id="testing-new-chaincode">
<h2>测试新链码<a class="headerlink" href="#testing-new-chaincode" title="永久链接至标题">¶</a></h2>
<p>默认情况下，我们只挂载`sacc``。然而，您可以通过将不同的链码添加到 <code class="docutils literal notranslate"><span class="pre">chaincode</span></code> 子目录并重新启动您的网络，从而轻松地测试不同的链码。此时，它们将可在您的``chaincode``容器中被访问。</p>
</div>
<div class="section" id="chaincode-access-control">
<h2>链码访问控制<a class="headerlink" href="#chaincode-access-control" title="永久链接至标题">¶</a></h2>
<p>链码可以通过调用GetCreator()函数来利用客户端(提交者)证书进行访问控制决策。此外，Go shim还提供了扩展API，从提交者的证书中提取客户端身份，这些API可用于访问控制决策，无论是基于客户端身份本身、org身份，还是基于客户端身份属性。</p>
<p>例如，表示为键/值的资产可能包含作为值的一部分的客户端身份(例如表示该资产所有者的JSON属性)，并且只有这个客户端可能被授权在将来更新键/值。可以在链码中使用客户端身份库扩展API来检索提交者信息，从而做出这样的访问控制决策。</p>
<p>有关详细信息，请参见`客户端身份(CID)库文档 &lt;<a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/core/chaincode/shim/ext/cid/README.md">https://github.com/hyperledger/fabric/blob/master/core/chaincode/shim/ext/cid/README.md</a>&gt;`_ 。</p>
<p>要将客户端身份shim扩展作为依赖项添加到链码中，请参见  <a class="reference internal" href="#vendoring"><span class="std std-ref">管理用Go编写的链码的外部依赖关系</span></a>。</p>
</div>
<div class="section" id="chaincode-encryption">
<h2>链码加密<a class="headerlink" href="#chaincode-encryption" title="永久链接至标题">¶</a></h2>
<p>链码在某些场景中，对与密钥关联的值进行整体或部分加密可能很有用。例如，如果一个人的社会安全号码或地址被写入了账本，那么您可能不希望这些数据以明文形式出现。链码加密是通过使用`实体扩展 &lt;<a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/chaincode/shim/ext/entities">https://github.com/hyperledger/fabric/tree/master/core/chaincode/shim/ext/entities</a>&gt;`__ 来实现的，该扩展是一个BCCSP包装器，带有商品工厂和函数，用于执行类似加密和椭圆曲线数字签名等的加密操作。例如，要加密，链码的调用程序通过瞬态字段传入一个加密密钥。然后，可以将相同的密钥用于后续查询操作，从而对加密的状态值进行正确的解密。</p>
<p>有关更多信息和示例，请参见“fabric/examples”目录中的`Encc例子 &lt;<a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/examples/chaincode/go/enccc_example">https://github.com/hyperledger/fabric/tree/master/examples/chaincode/go/enccc_example</a>&gt;`__。要特别注意 <code class="docutils literal notranslate"><span class="pre">utils.go</span></code> 辅助程序。这个实用程序加载链码shim API和实体扩展，并构建一个新的函数类（例如``encryptAndPutState`` &amp; <code class="docutils literal notranslate"><span class="pre">getStateAndDecrypt</span></code>）来示范加密链码。因此，链码现在可以将基本shim API 的``Get`` /<code class="docutils literal notranslate"><span class="pre">Put``与``Encrypt</span></code> /<a href="#id1"><span class="problematic" id="id2">``</span></a>Decrypt``的附加功能结合起来。</p>
<p>要将加密实体扩展作为依赖项添加到链码中，请参见 <a class="reference internal" href="#vendoring"><span class="std std-ref">管理用Go编写的链码的外部依赖关系</span></a>.</p>
</div>
<div class="section" id="managing-external-dependencies-for-chaincode-written-in-go">
<span id="vendoring"></span><h2>管理用Go编写的链码的外部依赖关系<a class="headerlink" href="#managing-external-dependencies-for-chaincode-written-in-go" title="永久链接至标题">¶</a></h2>
<p>如果您的链码需要Go标准库没有提供的包，那么您需要在链码中包含这些包。将shim和任何扩展库作为依赖项添加到链码中也是一个很好的实践。</p>
<p>有`许多工具 &lt;<a class="reference external" href="https://github.com/golang/go/wiki/PackageManagementTools">https://github.com/golang/go/wiki/PackageManagementTools</a>&gt;`__ 可用于管理(或“处理”)这些依赖项。下面演示如何使用``govendor``:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>govendor init
govendor add +external  // Add all external package, or
govendor add github.com/external/pkg // Add specific external package
</pre></div>
</div>
<p>这将外部依赖项导入到本地的 <code class="docutils literal notranslate"><span class="pre">vendor</span></code> 目录中。如果您正在处理Fabric shim或shim扩展，请在执行govendor命令之前，将Fabric存储库克隆到您的$GOPATH/src/github.com/hyperledger目录。</p>
<p>一旦依赖项在chaincode目录中被处理，<code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">package``和``peer</span> <span class="pre">chaincode</span> <span class="pre">install</span></code> 操作将把与依赖项相关的代码包含到链码包中。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chaincode4noah.html" class="btn btn-neutral float-right" title="Chaincode for Operators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chaincode.html" class="btn btn-neutral" title="链码教程" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>